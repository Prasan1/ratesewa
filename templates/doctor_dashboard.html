{% extends "base.html" %}

{% block title %}Doctor Dashboard - RankSewa{% endblock %}

{% block content %}
<style>
    /* ---------- Design Tokens ---------- */
    :root{
        --surface: #ffffff;
        --surface-2: #f7fafc;
        --text: #0f172a;
        --muted: #64748b;
        --border: rgba(15, 23, 42, .08);
        --shadow: 0 10px 30px rgba(2, 6, 23, .08);
        --shadow-hover: 0 14px 40px rgba(2, 6, 23, .14);
        --radius-xl: 22px;
        --radius-lg: 16px;
        --radius-md: 12px;
    }

    /* ---------- Layout polish ---------- */
    .dash-wrap {
        background: radial-gradient(1200px 400px at 20% -10%, rgba(13,138,188,.12), transparent 60%),
                    radial-gradient(900px 420px at 90% 0%, rgba(123,44,191,.10), transparent 55%),
                    linear-gradient(180deg, #ffffff 0%, #fbfdff 30%, #ffffff 100%);
        border-radius: var(--radius-xl);
        padding: 24px;
        margin: 20px 0;
    }
    @media (max-width: 768px){
        .dash-wrap{
            padding: 16px;
            margin: 12px 0;
            border-radius: 16px;
        }
    }

    .section-title-row{
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:12px;
        margin: 8px 0 14px;
    }
    .section-title-row h4, .section-title-row h5{
        margin:0;
        font-weight: 700;
        color: var(--text);
        letter-spacing: -.2px;
    }
    .section-sub{
        color: var(--muted);
        font-size: .95rem;
        margin-top: 4px;
    }

    /* ---------- Cards ---------- */
    .card-clean{
        border: 1px solid var(--border);
        border-radius: var(--radius-lg);
        background: var(--surface);
        box-shadow: 0 1px 0 rgba(15,23,42,.02);
    }
    .card-clean:hover{
        box-shadow: var(--shadow);
    }

    .stat-card {
        border: 1px solid rgba(255,255,255,0.18);
        border-radius: 18px;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
        overflow: hidden;
        position: relative;
    }
    .stat-card:hover {
        transform: translateY(-6px);
        box-shadow: var(--shadow-hover) !important;
    }
    .stat-card .card-body { position: relative; z-index: 2; }
    .stat-icon {
        font-size: 3rem;
        opacity: 0.18;
        position: absolute;
        right: 16px;
        bottom: 14px;
        z-index: 1;
    }

    .gradient-purple { background: linear-gradient(135deg, var(--dash-1-start) 0%, var(--dash-1-end) 100%); }
    .gradient-blue   { background: linear-gradient(135deg, var(--dash-2-start) 0%, var(--dash-2-end) 100%); }
    .gradient-orange { background: linear-gradient(135deg, var(--dash-3-start) 0%, var(--dash-3-end) 100%); }
    .gradient-green  { background: linear-gradient(135deg, var(--dash-4-start) 0%, var(--dash-4-end) 100%); }

    .action-card {
        border-radius: 16px;
        transition: all 0.25s ease;
        border: 1px solid var(--border);
        background: var(--surface);
    }
    .action-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow);
        border-color: rgba(13,138,188,.35);
    }

    /* ---------- Hero ---------- */
    .profile-hero {
        background: linear-gradient(135deg, var(--dash-1-start) 0%, var(--dash-1-end) 100%);
        border-radius: var(--radius-xl);
        padding: 2rem;
        color: white;
        margin-bottom: 1rem;
        position: relative;
        overflow: hidden;
        box-shadow: var(--shadow);
    }
    .profile-hero::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.11) 0%, transparent 70%);
        animation: pulse 4s ease-in-out infinite;
    }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }

    .verified-badge {
        display: inline-flex;
        align-items: center;
        gap: .5rem;
        background: rgba(255,255,255,0.22);
        padding: .45rem .9rem;
        border-radius: 999px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.18);
    }

    .quick-stat {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: rgba(255,255,255,0.14);
        border-radius: 14px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.14);
    }

    /* ---------- Trust / Privacy banner ---------- */
    .privacy-banner{
        border-radius: 16px;
        border: 1px solid rgba(13,138,188,.20);
        background: linear-gradient(135deg, rgba(13,138,188,.08) 0%, rgba(123,44,191,.06) 100%);
        padding: 14px 16px;
        display:flex;
        align-items:flex-start;
        gap:12px;
    }
    .privacy-banner i{ margin-top: 3px; }
    .privacy-banner strong{ color: var(--text); }
    .privacy-banner .small{ color: var(--muted); }

    /* ---------- Profile strength ---------- */
    .progress-wrap{
        background: #eef2ff;
        border-radius: 999px;
        height: 12px;
        overflow: hidden;
        border: 1px solid rgba(15,23,42,.06);
    }
    .progress-bar-custom{
        height: 12px;
        border-radius: 999px;
        background: linear-gradient(90deg, rgba(13,138,188,1) 0%, rgba(123,44,191,1) 100%);
        width: 0%;
    }
    .checklist li{
        margin: 8px 0;
        display:flex;
        gap:10px;
        align-items:flex-start;
        color: var(--muted);
    }
    .checklist li i{ margin-top: 3px; }
    .pill{
        display:inline-flex;
        align-items:center;
        gap:8px;
        border-radius: 999px;
        padding: .35rem .7rem;
        border: 1px solid var(--border);
        background: rgba(255,255,255,.75);
        color: var(--text);
        font-size: .85rem;
    }
</style>

<div class="container">
    <div class="dash-wrap">

        <!-- Profile Hero -->
        <div class="profile-hero">
            <div class="row align-items-center position-relative" style="z-index: 2;">
                <div class="col-md-8">
                    <div class="d-flex align-items-center mb-3">
                        <div class="me-4">
                            {% if doctor.photo_url %}
                            {% set photo_path = doctor.photo_url.replace('photos/', '') %}
                            <img src="{{ url_for('serve_photo', filename=photo_path) }}"
                                 alt="{{ doctor.name }}"
                                 style="width: 96px; height: 96px; border-radius: 50%; object-fit: cover; border: 4px solid rgba(255,255,255,.95); box-shadow: 0 8px 26px rgba(0,0,0,0.22);"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div style="width: 96px; height: 96px; background: rgba(255,255,255,.95); border-radius: 50%; display: none; align-items: center; justify-content: center; box-shadow: 0 8px 26px rgba(0,0,0,0.22);">
                                <i class="fas fa-user-md text-brand" style="font-size: 2.7rem;"></i>
                            </div>
                            {% else %}
                            <div style="width: 96px; height: 96px; background: rgba(255,255,255,.95); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 26px rgba(0,0,0,0.22);">
                                <i class="fas fa-user-md text-brand" style="font-size: 2.7rem;"></i>
                            </div>
                            {% endif %}
                        </div>
                        <div>
                            <h1 class="mb-2" style="font-weight: 800; letter-spacing: -.4px;">{{ doctor.name|doctor_title }}</h1>
                            <p class="mb-2" style="font-size: 1.08rem; opacity: 0.92;">
                                <i class="fas fa-stethoscope me-2"></i>{{ doctor.specialty.name }}
                            </p>
                            <div class="d-flex flex-wrap gap-2">
                                <span class="verified-badge">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Verified Doctor</span>
                                </span>
                                <span class="pill">
                                    <i class="fas fa-shield-alt"></i> Private dashboard
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <a href="{{ url_for('doctor_profile', slug=doctor.slug) }}" target="_blank" class="btn btn-light btn-lg shadow">
                        <i class="fas fa-external-link-alt me-2"></i>View Public Profile
                    </a>
                </div>
            </div>

            <!-- Quick Stats row -->
            <div class="row mt-4 position-relative" style="z-index: 2;">
                <div class="col-md-3 col-6 mb-3 mb-md-0">
                    <div class="quick-stat">
                        <i class="fas fa-map-marker-alt fa-2x"></i>
                        <div>
                            <small style="opacity: 0.82;">Location</small>
                            <div><strong>{{ doctor.city.name }}</strong></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-3 mb-md-0">
                    <div class="quick-stat">
                        <i class="fas fa-graduation-cap fa-2x"></i>
                        <div>
                            <small style="opacity: 0.82;">Experience</small>
                            <div><strong>{{ doctor.experience or 0 }} Years</strong></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-3 mb-md-0">
                    <div class="quick-stat">
                        <i class="fas fa-certificate fa-2x"></i>
                        <div>
                            <small style="opacity: 0.82;">NMC Number</small>
                            <div><strong>{{ doctor.nmc_number or '-' }}</strong></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="quick-stat">
                        <i class="fas fa-crown fa-2x"></i>
                        <div>
                            <small style="opacity: 0.82;">Tier</small>
                            <div><strong>{{ doctor.subscription_tier.title() }}</strong></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Privacy reassurance + value -->
        <div class="mb-4">
            <div class="privacy-banner">
                <i class="fas fa-lock text-primary"></i>
                <div>
                    <div><strong>Your dashboard is private.</strong> Only you can see analytics after login.</div>
                    <div class="small">RankSewa staff (including admins) can only view your public profile—exactly what patients see.</div>
                </div>
            </div>
        </div>

        <!-- Promo banner (unchanged logic) -->
        {% set promo = get_promotion_banner() %}
        {% if promo and doctor.subscription_tier == 'free' %}
        <div class="alert shadow-lg mb-4" style="background: linear-gradient(135deg, {{ promo.color }} 0%, var(--brand) 100%); border: none; border-radius: 16px;">
            <div class="row align-items-center text-white">
                <div class="col-md-8">
                    <h4 class="mb-2"><i class="fas fa-gift me-2"></i>{{ promo.message }}</h4>
                    <p class="mb-0">Get instant access to Premium or Featured tier — FREE for {{ promo.days_left }} days. No credit card required.</p>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <a href="{{ url_for('subscription_pricing') }}" class="btn btn-light btn-lg shadow">
                        <i class="fas fa-rocket me-2"></i>Claim Free Premium
                    </a>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Stats -->
        <div class="section-title-row">
            <div>
                <h4><i class="fas fa-chart-pie me-2 text-primary"></i>Performance Overview</h4>
                <div class="section-sub">A quick snapshot of your visibility and patient feedback.</div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card shadow-sm gradient-purple text-white">
                    <div class="card-body p-4">
                        <i class="fas fa-eye stat-icon"></i>
                        <h6 class="mb-2" style="opacity: 0.92; font-weight: 600;">Profile Views</h6>
                        <h2 class="mb-0" style="font-weight: 800;">{{ "{:,}".format(doctor.profile_views or 0) }}</h2>
                        <small style="opacity: 0.85;">Total impressions</small>
                    </div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card shadow-sm gradient-blue text-white">
                    <div class="card-body p-4">
                        <i class="fas fa-star stat-icon"></i>
                        <h6 class="mb-2" style="opacity: 0.92; font-weight: 600;">Total Reviews</h6>
                        <h2 class="mb-0" style="font-weight: 800;">{{ review_count }}</h2>
                        <small style="opacity: 0.85;">Patient feedback</small>
                    </div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card shadow-sm gradient-orange text-white">
                    <div class="card-body p-4">
                        <i class="fas fa-chart-line stat-icon"></i>
                        <h6 class="mb-2" style="opacity: 0.92; font-weight: 600;">Average Rating</h6>
                        <h2 class="mb-0" style="font-weight: 800;">
                            {{ "%.1f"|format(avg_rating) }}<small style="font-size: 1.5rem;">/5</small>
                        </h2>
                        <small style="opacity: 0.85;">{% for i in range(avg_rating|int) %}★{% endfor %}</small>
                    </div>
                </div>
            </div>

            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card shadow-sm gradient-green text-white">
                    <div class="card-body p-4">
                        <i class="fas fa-reply stat-icon"></i>
                        <h6 class="mb-2" style="opacity: 0.92; font-weight: 600;">Response Rate</h6>
                        <h2 class="mb-0" style="font-weight: 800;">{{ "%.0f"|format(response_rate) }}%</h2>
                        <small style="opacity: 0.85;">Reviews responded</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions + Profile Strength -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="section-title-row">
                    <div>
                        <h4><i class="fas fa-bolt me-2 text-primary"></i>Quick Actions</h4>
                        <div class="section-sub">Make your profile stronger in 2–3 minutes.</div>
                    </div>
                </div>
            </div>

            <!-- Profile strength card -->
            {% set has_edu = doctor.education and doctor.education|length > 2 %}
            {% set has_college = doctor.college and doctor.college|length > 2 %}
            {% set has_address = doctor.practice_address and doctor.practice_address|length > 5 %}
            {% set has_phone = doctor.phone_number and doctor.phone_number|length > 5 %}
            {% set has_photo = doctor.photo_url %}
            {% set strength_points = 0 %}
            {% if has_photo %}{% set strength_points = strength_points + 20 %}{% endif %}
            {% if has_edu %}{% set strength_points = strength_points + 20 %}{% endif %}
            {% if has_college %}{% set strength_points = strength_points + 15 %}{% endif %}
            {% if has_address %}{% set strength_points = strength_points + 25 %}{% endif %}
            {% if has_phone %}{% set strength_points = strength_points + 20 %}{% endif %}
            {% set profile_strength = strength_points %}

            <div class="col-lg-4 mb-3">
                <div class="card-clean p-4 h-100">
                    <div class="d-flex align-items-start justify-content-between">
                        <div>
                            <h5 class="mb-1" style="font-weight:800; letter-spacing:-.2px;">Profile Strength</h5>
                            <div class="text-muted">Complete your details to increase trust and visibility.</div>
                        </div>
                        <span class="pill"><i class="fas fa-magic"></i> {{ profile_strength }}%</span>
                    </div>

                    <div class="mt-3 progress-wrap">
                        <div class="progress-bar-custom" style="width: {{ profile_strength }}%;"></div>
                    </div>

                    <ul class="checklist mt-3 mb-0 ps-0" style="list-style:none;">
                        <li>
                            <i class="fas {{ 'fa-check-circle text-success' if has_photo else 'fa-circle text-muted' }}"></i>
                            <span>Add a profile photo</span>
                        </li>
                        <li>
                            <i class="fas {{ 'fa-check-circle text-success' if has_edu else 'fa-circle text-muted' }}"></i>
                            <span>Add education</span>
                        </li>
                        <li>
                            <i class="fas {{ 'fa-check-circle text-success' if has_address else 'fa-circle text-muted' }}"></i>
                            <span>Add practice address</span>
                        </li>
                        <li>
                            <i class="fas {{ 'fa-check-circle text-success' if has_phone else 'fa-circle text-muted' }}"></i>
                            <span>Add phone number</span>
                        </li>
                    </ul>

                    <div class="mt-3 d-grid">
                        <a href="{{ url_for('doctor_profile_edit') }}" class="btn btn-primary">
                            <i class="fas fa-pen me-2"></i>Improve My Profile
                        </a>
                    </div>
                </div>
            </div>

            <!-- Your existing actions (same links) -->
            <div class="col-lg-8">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <a href="{{ url_for('doctor_profile_edit') }}" class="text-decoration-none">
                            <div class="action-card card h-100">
                                <div class="card-body text-center p-4">
                                    <div style="width: 58px; height: 58px; background: linear-gradient(135deg, var(--dash-1-start) 0%, var(--dash-1-end) 100%); border-radius: 50%; display:flex; align-items:center; justify-content:center; margin: 0 auto 1rem;">
                                        <i class="fas fa-edit fa-2x text-white"></i>
                                    </div>
                                    <h6 class="mb-2" style="font-weight:800; color:var(--text);">Edit Profile</h6>
                                    <small class="text-muted">Update your information</small>
                                </div>
                            </div>
                        </a>
                    </div>

                    <div class="col-md-6 mb-3">
                        <a href="{{ url_for('doctor_reviews') }}" class="text-decoration-none">
                            <div class="action-card card h-100">
                                <div class="card-body text-center p-4">
                                    <div style="width: 58px; height: 58px; background: linear-gradient(135deg, var(--dash-2-start) 0%, var(--dash-2-end) 100%); border-radius: 50%; display:flex; align-items:center; justify-content:center; margin: 0 auto 1rem;">
                                        <i class="fas fa-comments fa-2x text-white"></i>
                                    </div>
                                    <h6 class="mb-2" style="font-weight:800; color:var(--text);">Manage Reviews</h6>
                                    <small class="text-muted">Respond to patient feedback</small>
                                </div>
                            </div>
                        </a>
                    </div>

                    <div class="col-md-6 mb-3">
                        {% if tier_features is defined and tier_features.can_view_analytics %}
                        <a href="{{ url_for('doctor_analytics') }}" class="text-decoration-none">
                            <div class="action-card card h-100">
                                <div class="card-body text-center p-4">
                                    <div style="width: 58px; height: 58px; background: linear-gradient(135deg, var(--dash-3-start) 0%, var(--dash-3-end) 100%); border-radius: 50%; display:flex; align-items:center; justify-content:center; margin: 0 auto 1rem;">
                                        <i class="fas fa-chart-bar fa-2x text-white"></i>
                                    </div>
                                    <h6 class="mb-2" style="font-weight:800; color:var(--text);">View Analytics</h6>
                                    <small class="text-muted">Track your performance</small>
                                </div>
                            </div>
                        </a>
                        {% else %}
                        <a href="{{ url_for('subscription_pricing') }}" class="text-decoration-none">
                            <div class="action-card card h-100" style="border-color: rgba(255,193,7,.6);">
                                <div class="card-body text-center p-4">
                                    <div style="width: 58px; height: 58px; background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); border-radius: 50%; display:flex; align-items:center; justify-content:center; margin: 0 auto 1rem;">
                                        <i class="fas fa-lock fa-2x text-white"></i>
                                    </div>
                                    <h6 class="mb-2" style="font-weight:800; color:var(--text);">
                                        Analytics <span class="badge bg-warning text-dark">Premium</span>
                                    </h6>
                                    <small class="text-muted">Upgrade to unlock insights</small>
                                </div>
                            </div>
                        </a>
                        {% endif %}
                    </div>

                    <div class="col-md-6 mb-3">
                        <a href="{{ url_for('subscription_pricing') }}" class="text-decoration-none">
                            <div class="action-card card h-100">
                                <div class="card-body text-center p-4">
                                    <div style="width: 58px; height: 58px; background: linear-gradient(135deg, var(--dash-4-start) 0%, var(--dash-4-end) 100%); border-radius: 50%; display:flex; align-items:center; justify-content:center; margin: 0 auto 1rem;">
                                        <i class="fas fa-rocket fa-2x text-white"></i>
                                    </div>
                                    <h6 class="mb-2" style="font-weight:800; color:var(--text);">Increase Visibility</h6>
                                    <small class="text-muted">Get more priority in your city</small>
                                </div>
                            </div>
                        </a>
                    </div>

                </div>
            </div>
        </div>

        <!-- Keep your existing Detailed Information / Working Hours / Help sections unchanged -->
        <!-- (I’m leaving them as-is so you don’t lose any functionality.) -->

        <!-- Detailed Information -->
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="card shadow-sm" style="border-radius: 16px; border: none;">
                    <div class="card-header" style="background: linear-gradient(135deg, var(--dash-1-start) 0%, var(--dash-1-end) 100%); border-radius: 16px 16px 0 0; border: none;">
                        <h5 class="mb-0 text-white"><i class="fas fa-user-md me-2"></i>Professional Information</h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="mb-3">
                            <label class="text-muted small mb-1">Full Name</label>
                            <div class="h6">{{ doctor.name }}</div>
                        </div>
                        <div class="mb-3">
                            <label class="text-muted small mb-1">Specialty</label>
                            <div class="h6">{{ doctor.specialty.name }}</div>
                        </div>
                        <div class="mb-3">
                            <label class="text-muted small mb-1">Education</label>
                            <div>{{ doctor.education or '-' }}</div>
                        </div>
                        <div class="mb-3">
                            <label class="text-muted small mb-1">Medical College</label>
                            <div>{{ doctor.college or '-' }}</div>
                        </div>
                        <div class="mb-3">
                            <label class="text-muted small mb-1">Practice Address</label>
                            <div>{{ doctor.practice_address or '-' }}</div>
                        </div>
                        <div class="mb-3">
                            <label class="text-muted small mb-1">Status</label>
                            <div>
                                {% if doctor.is_verified %}
                                <span class="badge" style="background: linear-gradient(135deg, var(--dash-4-start) 0%, var(--dash-4-end) 100%); padding: 0.5rem 1rem; border-radius: 50px;">
                                    <i class="fas fa-check-circle"></i> Verified Doctor
                                </span>
                                {% endif %}
                                {% if doctor.is_featured %}
                                <span class="badge" style="background: linear-gradient(135deg, var(--dash-3-start) 0%, var(--dash-3-end) 100%); padding: 0.5rem 1rem; border-radius: 50px;">
                                    <i class="fas fa-star"></i> Featured
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 mb-4">
                <div class="card shadow-sm" style="border-radius: 16px; border: none;">
                    <div class="card-header" style="background: linear-gradient(135deg, var(--dash-2-start) 0%, var(--dash-2-end) 100%); border-radius: 16px 16px 0 0; border: none;">
                        <h5 class="mb-0 text-white"><i class="fas fa-user-circle me-2"></i>Account Settings</h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="mb-3">
                            <label class="text-muted small mb-1">Email Address</label>
                            <div class="h6">{{ user.email }}</div>
                        </div>
                        <div class="mb-3">
                            <label class="text-muted small mb-1">Phone Number</label>
                            <div>{{ doctor.phone_number or '-' }}</div>
                        </div>
                        <div class="mb-3">
                            <label class="text-muted small mb-1">Account Type</label>
                            <div>
                                <span class="badge bg-primary" style="padding: 0.5rem 1rem; border-radius: 50px;">
                                    <i class="fas fa-user-md"></i> Verified Doctor
                                </span>
                            </div>
                        </div>

                        <hr class="my-4">

                        <div class="alert" style="background: rgba(13,138,188, 0.08); border: 1px solid rgba(13,138,188, 0.18); border-radius: 12px;">
                            <small>
                                <i class="fas fa-info-circle me-1 text-primary"></i>
                                <strong>Need to update?</strong> Contact support to change your name, specialty, or city.
                            </small>
                        </div>

                        <div class="d-grid gap-2 mt-3">
                            <a href="{{ url_for('user_profile') }}" class="btn btn-outline-primary">
                                <i class="fas fa-key me-2"></i>Change Password
                            </a>
                            <a href="{{ url_for('doctor_delete_account') }}" class="btn btn-outline-danger">
                                <i class="fas fa-trash-alt me-2"></i>Delete Account
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Working Hours (your original section stays) -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm" style="border-radius: 16px; border: none;">
                    <div class="card-header" style="background: linear-gradient(135deg, var(--dash-3-start) 0%, var(--dash-3-end) 100%); border-radius: 16px 16px 0 0; border: none;">
                        <h5 class="mb-0 text-white">
                            <i class="far fa-clock me-2"></i>Working Hours
                            {% if tier_features is defined and not tier_features.can_show_hours %}
                            <span class="badge bg-warning text-dark float-end">Premium</span>
                            {% endif %}
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        {% if tier_features is defined and tier_features.can_show_hours %}
                        <p class="text-muted mb-4">
                            <i class="fas fa-info-circle me-1"></i>
                            Set your working hours to help patients know when you're available.
                        </p>

                        <form method="POST" action="{{ url_for('doctor_update_working_hours') }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                            <div class="row">
                                {% set days_order = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'] %}
                                {% set days_display = {'monday': 'Monday', 'tuesday': 'Tuesday', 'wednesday': 'Wednesday', 'thursday': 'Thursday', 'friday': 'Friday', 'saturday': 'Saturday', 'sunday': 'Sunday'} %}
                                {% set working_hours_data = {} %}
                                {% if doctor.working_hours %}
                                    {% set working_hours_data = doctor.working_hours|from_json %}
                                {% endif %}

                                {% for day in days_order %}
                                <div class="col-md-6 mb-3">
                                    <label for="{{ day }}" class="form-label fw-bold">{{ days_display[day] }}</label>
                                    <input type="text" class="form-control" id="{{ day }}" name="{{ day }}"
                                           value="{{ working_hours_data[day] if working_hours_data and day in working_hours_data else '' }}"
                                           placeholder="e.g., 9:00 AM - 5:00 PM or Closed">
                                    <small class="text-muted">Leave blank or write "Closed" if not available</small>
                                </div>
                                {% endfor %}
                            </div>

                            <div class="alert alert-info mt-3">
                                <i class="fas fa-lightbulb me-2"></i>
                                <strong>Tips:</strong> Use formats like "9:00 AM - 5:00 PM", "10:00-17:00", or "By appointment only"
                            </div>

                            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Save Working Hours
                                </button>
                            </div>
                        </form>

                        {% else %}
                        <div class="text-center py-5">
                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
                                <i class="fas fa-lock fa-3x text-white"></i>
                            </div>
                            <h5 class="mb-3">Working Hours — Premium Feature</h5>
                            <p class="text-muted mb-4">
                                Upgrade to Premium to display working hours and help patients plan visits with confidence.
                            </p>
                            <a href="{{ url_for('subscription_pricing') }}" class="btn btn-warning btn-lg">
                                <i class="fas fa-crown me-2"></i>Upgrade to Premium
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Help -->
        <div class="card shadow-sm mb-2" style="border-radius: 16px; border: none; background: linear-gradient(135deg, #f8f5ff 0%, #e8f5e9 100%);">
            <div class="card-body p-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h5 class="mb-2"><i class="fas fa-question-circle me-2 text-primary"></i>Need Help?</h5>
                        <p class="mb-0 text-muted">Our support team is here to help you succeed on RankSewa.</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="mailto:support@ranksewa.com" class="btn btn-primary">
                            <i class="fas fa-envelope me-2"></i>Contact Support
                        </a>
                    </div>
                </div>
            </div>
        </div>

    </div><!-- /dash-wrap -->
</div>
{% endblock %}
