{% extends "base.html" %}

{% block title %}{{ clinic.name }} - Doctors & Appointments | RankSewa{% endblock %}

{% block meta %}
<meta name="description" content="{{ clinic.name }} - {{ clinic.clinic_type|title }} in {{ clinic.city or 'Nepal' }}. View our {{ clinic_doctors|length }} verified doctors and book appointments online.">
{% endblock %}

{% block content %}
<div class="clinic-page">
    <!-- Hero Section -->
    <section class="clinic-hero">
        <div class="container">
            <nav class="mb-4">
                <a href="{{ url_for('clinics') }}" class="back-link">
                    <i class="fas fa-arrow-left"></i> All Clinics
                </a>
            </nav>

            <div class="hero-content">
                <div class="clinic-identity">
                    {% if clinic.logo_url %}
                    <div class="clinic-logo">
                        <img src="{% if clinic.logo_url.startswith('http') %}{{ clinic.logo_url }}{% else %}{{ url_for('serve_clinic_logo', filename=clinic.logo_url.replace('clinic_logos/', '')) }}{% endif %}"
                             alt="{{ clinic.name }}">
                    </div>
                    {% else %}
                    <div class="clinic-logo clinic-logo--placeholder">
                        <span>{{ clinic.name[:2]|upper }}</span>
                    </div>
                    {% endif %}

                    <div class="clinic-info">
                        <div class="clinic-badges">
                            <span class="badge badge--type">{{ clinic.clinic_type|title }}</span>
                            {% if clinic.is_verified %}
                            <span class="badge badge--verified">
                                <i class="fas fa-shield-alt"></i> Verified
                            </span>
                            {% endif %}
                        </div>
                        <h1 class="clinic-name">{{ clinic.name }}</h1>
                        {% if clinic.description %}
                        <p class="clinic-tagline">{{ clinic.description[:150] }}{% if clinic.description|length > 150 %}...{% endif %}</p>
                        {% endif %}
                    </div>
                </div>

                <div class="clinic-stats">
                    <div class="stat">
                        <div class="stat-value">{{ clinic_doctors|length }}</div>
                        <div class="stat-label">Doctors</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Quick Contact Bar -->
    <section class="contact-bar">
        <div class="container">
            <div class="contact-items">
                {% if clinic.address or clinic.city %}
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>{{ clinic.address }}{% if clinic.address and clinic.city %}, {% endif %}{{ clinic.city }}</span>
                </div>
                {% endif %}

                {% if clinic.phone or clinic.phone_number %}
                <a href="tel:{{ clinic.phone or clinic.phone_number }}" class="contact-item contact-item--link">
                    <i class="fas fa-phone-alt"></i>
                    <span>{{ clinic.phone or clinic.phone_number }}</span>
                </a>
                {% endif %}

                {% if clinic.email %}
                <a href="mailto:{{ clinic.email }}" class="contact-item contact-item--link">
                    <i class="fas fa-envelope"></i>
                    <span>{{ clinic.email }}</span>
                </a>
                {% endif %}

                {% if clinic.website %}
                <a href="{{ clinic.website }}" target="_blank" rel="noopener" class="contact-item contact-item--link">
                    <i class="fas fa-globe"></i>
                    <span>Website</span>
                </a>
                {% endif %}

                {% set full_address = [clinic.address, clinic.city, 'Nepal']|select|join(', ') %}
                <a href="https://www.google.com/maps/search/?api=1&query={{ full_address|urlencode }}"
                   target="_blank" rel="noopener"
                   class="contact-item contact-item--cta">
                    <i class="fas fa-directions"></i>
                    <span>Get Directions</span>
                </a>
            </div>
        </div>
    </section>

    <!-- Doctors Section -->
    <section class="doctors-section">
        <div class="container">
            <div class="section-header">
                <h2><i class="fas fa-user-md"></i> Our Doctors</h2>
                <p class="section-subtitle">Meet our team of verified healthcare professionals</p>
            </div>

            {% if clinic_doctors %}
            <div class="doctors-grid">
                {% for cd in clinic_doctors %}
                <article class="doctor-card">
                    <div class="doctor-card__header">
                        {% if cd.doctor.photo_url %}
                        {% set photo_path = cd.doctor.photo_url.replace('photos/', '') %}
                        <img src="{{ url_for('serve_photo', filename=photo_path) }}"
                             alt="{{ cd.doctor.name }}"
                             class="doctor-card__photo">
                        {% else %}
                        {% set name_parts = cd.doctor.name.replace('Dr. ', '').replace('Dr.', '').split() %}
                        {% set initials = name_parts[0][:1] ~ (name_parts[-1][:1] if name_parts|length > 1 else '') %}
                        <div class="doctor-card__photo doctor-card__photo--placeholder">
                            {{ initials|upper }}
                        </div>
                        {% endif %}

                        <div class="doctor-card__identity">
                            <h3 class="doctor-card__name">
                                <a href="{{ url_for('doctor_profile', doctor_slug=cd.doctor.slug) }}">
                                    {{ cd.doctor.name }}
                                </a>
                            </h3>
                            <p class="doctor-card__specialty">
                                {{ cd.doctor.specialty.name if cd.doctor.specialty else 'General Physician' }}
                            </p>
                            {% if cd.doctor.is_verified %}
                            <span class="doctor-card__verified">
                                <i class="fas fa-check-circle"></i> Verified
                            </span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="doctor-card__details">
                        {% if cd.consultation_fee %}
                        <div class="doctor-card__fee">
                            <span class="fee-label">Consultation Fee</span>
                            <span class="fee-value">NPR {{ cd.consultation_fee }}</span>
                        </div>
                        {% endif %}

                        {% if cd.role and cd.role != 'consultant' %}
                        <div class="doctor-card__role">
                            <i class="fas fa-id-badge"></i> {{ cd.role|title }}
                        </div>
                        {% endif %}
                    </div>

                    {% set schedules = cd.get_schedules() %}
                    {% if schedules %}
                    <div class="doctor-card__schedule">
                        <div class="schedule-label">
                            <i class="fas fa-clock"></i> Available
                        </div>
                        <div class="schedule-days">
                            {% set days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'] %}
                            {% for s in schedules %}
                            <span class="schedule-day">
                                {{ days[s.day_of_week] }} {{ s.start_time.strftime('%I:%M %p').lstrip('0') }}
                            </span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <div class="doctor-card__actions">
                        {% if schedules and cd.accepts_online_booking %}
                        <a href="{{ url_for('clinic_book_appointment', clinic_slug=clinic.slug, doctor_id=cd.doctor.id) }}"
                           class="btn btn--primary">
                            <i class="fas fa-calendar-check"></i> Book Appointment
                        </a>
                        {% else %}
                        <a href="{{ url_for('doctor_profile', doctor_slug=cd.doctor.slug) }}"
                           class="btn btn--secondary">
                            <i class="fas fa-user"></i> View Profile
                        </a>
                        {% endif %}
                    </div>
                </article>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state__icon">
                    <i class="fas fa-user-md"></i>
                </div>
                <h3>No Doctors Listed Yet</h3>
                <p>This clinic is setting up their doctor profiles. Check back soon.</p>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Location Section -->
    {% if clinic.address or clinic.city %}
    <section class="location-section">
        <div class="container">
            <div class="location-card">
                <div class="location-info">
                    <h3><i class="fas fa-hospital"></i> Visit Us</h3>
                    <address>
                        {{ clinic.name }}<br>
                        {% if clinic.address %}{{ clinic.address }}<br>{% endif %}
                        {% if clinic.city %}{{ clinic.city }}, Nepal{% endif %}
                    </address>
                    {% if clinic.phone or clinic.phone_number %}
                    <p class="location-phone">
                        <i class="fas fa-phone-alt"></i>
                        <a href="tel:{{ clinic.phone or clinic.phone_number }}">
                            {{ clinic.phone or clinic.phone_number }}
                        </a>
                    </p>
                    {% endif %}
                </div>
                <div class="location-cta">
                    {% set full_address = [clinic.name, clinic.address, clinic.city, 'Nepal']|select|join(', ') %}
                    <a href="https://www.google.com/maps/search/?api=1&query={{ full_address|urlencode }}"
                       target="_blank" rel="noopener"
                       class="btn btn--outline">
                        <i class="fas fa-map-marked-alt"></i> Open in Google Maps
                    </a>
                </div>
            </div>
        </div>
    </section>
    {% endif %}
</div>

<style>
/* Clinic Page - Professional Medical Style */
.clinic-page {
    background: #f8fafc;
    min-height: 100vh;
}

/* Hero Section */
.clinic-hero {
    background: white;
    padding: 2rem 0 3rem;
    border-bottom: 1px solid #e2e8f0;
}

.back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: #64748b;
    text-decoration: none;
    font-size: 0.9rem;
    transition: color 0.2s;
}

.back-link:hover {
    color: var(--brand);
}

.hero-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 2rem;
}

.clinic-identity {
    display: flex;
    gap: 1.5rem;
    align-items: flex-start;
}

.clinic-logo {
    flex-shrink: 0;
    width: 100px;
    height: 100px;
    border-radius: 16px;
    overflow: hidden;
    background: white;
    border: 2px solid #e2e8f0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.clinic-logo img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    padding: 8px;
}

.clinic-logo--placeholder {
    background: linear-gradient(135deg, var(--brand) 0%, #0d9488 100%);
    border: none;
}

.clinic-logo--placeholder span {
    color: white;
    font-size: 2rem;
    font-weight: 700;
}

.clinic-badges {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.badge {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge--type {
    background: #f1f5f9;
    color: #475569;
}

.badge--verified {
    background: #dcfce7;
    color: #166534;
}

.clinic-name {
    font-size: 2rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0 0 0.5rem;
    line-height: 1.2;
}

.clinic-tagline {
    color: #64748b;
    font-size: 1rem;
    margin: 0;
    max-width: 500px;
    line-height: 1.5;
}

.clinic-stats {
    text-align: center;
    padding: 1rem 2rem;
    background: var(--brand-soft);
    border-radius: 12px;
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--brand);
    line-height: 1;
}

.stat-label {
    font-size: 0.875rem;
    color: #64748b;
    margin-top: 0.25rem;
}

/* Contact Bar */
.contact-bar {
    background: white;
    border-bottom: 1px solid #e2e8f0;
    padding: 1rem 0;
}

.contact-items {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    align-items: center;
}

.contact-item {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: #475569;
    font-size: 0.9rem;
    text-decoration: none;
}

.contact-item i {
    color: var(--brand);
    width: 16px;
    text-align: center;
}

.contact-item--link:hover {
    color: var(--brand);
}

.contact-item--cta {
    margin-left: auto;
    background: var(--brand);
    color: white !important;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-weight: 600;
    transition: background 0.2s;
}

.contact-item--cta i {
    color: white;
}

.contact-item--cta:hover {
    background: #0d9488;
    color: white !important;
}

/* Doctors Section */
.doctors-section {
    padding: 3rem 0;
}

.section-header {
    margin-bottom: 2rem;
}

.section-header h2 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
    margin: 0 0 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.section-header h2 i {
    color: var(--brand);
}

.section-subtitle {
    color: #64748b;
    margin: 0;
}

.doctors-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: 1.5rem;
}

/* Doctor Card */
.doctor-card {
    background: white;
    border-radius: 16px;
    border: 1px solid #e2e8f0;
    padding: 1.5rem;
    transition: box-shadow 0.2s, transform 0.2s;
}

.doctor-card:hover {
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
    transform: translateY(-2px);
}

.doctor-card__header {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

.doctor-card__photo {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    object-fit: cover;
    flex-shrink: 0;
}

.doctor-card__photo--placeholder {
    background: linear-gradient(135deg, var(--brand-soft) 0%, #e0f2f1 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--brand);
    font-size: 1.5rem;
    font-weight: 700;
}

.doctor-card__identity {
    flex: 1;
    min-width: 0;
}

.doctor-card__name {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0 0 0.25rem;
    line-height: 1.3;
}

.doctor-card__name a {
    color: #1e293b;
    text-decoration: none;
}

.doctor-card__name a:hover {
    color: var(--brand);
}

.doctor-card__specialty {
    color: #64748b;
    font-size: 0.9rem;
    margin: 0 0 0.25rem;
}

.doctor-card__verified {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    color: #16a34a;
    font-size: 0.8rem;
    font-weight: 500;
}

.doctor-card__details {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-top: 1px solid #f1f5f9;
    border-bottom: 1px solid #f1f5f9;
    margin-bottom: 1rem;
}

.doctor-card__fee {
    display: flex;
    flex-direction: column;
}

.fee-label {
    font-size: 0.75rem;
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.fee-value {
    font-size: 1.1rem;
    font-weight: 700;
    color: #1e293b;
}

.doctor-card__role {
    font-size: 0.85rem;
    color: #64748b;
}

.doctor-card__schedule {
    margin-bottom: 1rem;
}

.schedule-label {
    font-size: 0.8rem;
    color: #64748b;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
}

.schedule-days {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
}

.schedule-day {
    background: #f8fafc;
    color: #475569;
    padding: 0.25rem 0.6rem;
    border-radius: 6px;
    font-size: 0.8rem;
    border: 1px solid #e2e8f0;
}

.doctor-card__actions {
    margin-top: auto;
}

.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.75rem 1.25rem;
    border-radius: 10px;
    font-size: 0.95rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
    border: none;
    cursor: pointer;
}

.btn--primary {
    background: var(--brand);
    color: white;
}

.btn--primary:hover {
    background: #0d9488;
    color: white;
}

.btn--secondary {
    background: #f1f5f9;
    color: #475569;
}

.btn--secondary:hover {
    background: #e2e8f0;
    color: #1e293b;
}

.btn--outline {
    background: transparent;
    color: var(--brand);
    border: 2px solid var(--brand);
}

.btn--outline:hover {
    background: var(--brand);
    color: white;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 16px;
    border: 1px solid #e2e8f0;
}

.empty-state__icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 1.5rem;
    background: var(--brand-soft);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.empty-state__icon i {
    font-size: 2rem;
    color: var(--brand);
}

.empty-state h3 {
    color: #1e293b;
    margin: 0 0 0.5rem;
}

.empty-state p {
    color: #64748b;
    margin: 0;
}

/* Location Section */
.location-section {
    padding: 0 0 3rem;
}

.location-card {
    background: white;
    border-radius: 16px;
    border: 1px solid #e2e8f0;
    padding: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 2rem;
}

.location-info h3 {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1e293b;
    margin: 0 0 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.location-info h3 i {
    color: var(--brand);
}

.location-info address {
    font-style: normal;
    color: #475569;
    line-height: 1.6;
    margin-bottom: 0.75rem;
}

.location-phone {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.location-phone i {
    color: var(--brand);
}

.location-phone a {
    color: #1e293b;
    text-decoration: none;
    font-weight: 500;
}

.location-phone a:hover {
    color: var(--brand);
}

/* Responsive */
@media (max-width: 768px) {
    .hero-content {
        flex-direction: column;
    }

    .clinic-identity {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .clinic-tagline {
        max-width: 100%;
    }

    .clinic-stats {
        width: 100%;
    }

    .contact-items {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }

    .contact-item--cta {
        margin-left: 0;
        width: 100%;
        justify-content: center;
    }

    .doctors-grid {
        grid-template-columns: 1fr;
    }

    .location-card {
        flex-direction: column;
        text-align: center;
    }

    .location-info h3 {
        justify-content: center;
    }

    .location-phone {
        justify-content: center;
    }
}
</style>
{% endblock %}
