{% extends "base.html" %}

{% block title %}{{ clinic.name }} - Doctors & Appointments | RankSewa{% endblock %}

{% block meta %}
<meta name="description" content="{{ clinic.name }} - {{ clinic.clinic_type|title }} in {{ clinic.city or 'Nepal' }}. View our {{ clinic_doctors|length }} verified doctors and book appointments online.">
{% endblock %}

{% block content %}
{% set has_doctors = clinic_doctors|length > 0 %}
<div class="rs-clinic{% if not has_doctors %} rs-clinic--empty{% endif %}">
  <!-- HERO -->
  <header class="rs-hero">
    <div class="container">
      <nav class="rs-breadcrumb">
        <a href="{{ url_for('clinics') }}" class="rs-back">
          <i class="fas fa-arrow-left"></i> All Clinics
        </a>
      </nav>

      <div class="rs-hero-grid">
        {% set has_online_booking = clinic_doctors|selectattr('accepts_online_booking')|list|length > 0 %}
        <div class="rs-hero-card">
          <div class="rs-hero-top">
            {% if clinic.logo_url %}
              <div class="rs-logo">
                <img
                  src="{% if clinic.logo_url.startswith('http') %}{{ clinic.logo_url }}{% else %}{{ url_for('serve_clinic_logo', filename=clinic.logo_url.replace('clinic_logos/', '')) }}{% endif %}"
                  alt="{{ clinic.name }}"
                  loading="lazy"
                >
              </div>
            {% else %}
              <div class="rs-logo rs-logo--placeholder" aria-label="{{ clinic.name }}">
                <span>{{ clinic.name[:2]|upper }}</span>
              </div>
            {% endif %}

            <div class="rs-hero-meta">
              <div class="rs-badges">
                <span class="rs-badge rs-badge--type">
                  <i class="fas fa-hospital"></i> {{ clinic.clinic_type|title }}
                </span>
                {% if clinic.is_verified %}
                  <span class="rs-badge rs-badge--verified">
                    <i class="fas fa-shield-alt"></i> Verified Clinic
                  </span>
                {% endif %}
              </div>

              <h1 class="rs-title">{{ clinic.name }}</h1>

              <div class="rs-description" data-role="clinic-description">
                {% if clinic.description %}
                  <p class="rs-subtitle">{{ clinic.description }}</p>
                {% else %}
                  <p class="rs-subtitle">
                    A modern clinic page powered by RankSewa — verified doctors, transparent schedules, and online booking.
                  </p>
                {% endif %}
                <button class="rs-desc-toggle" type="button" aria-expanded="false">
                  Read more
                </button>
              </div>

              <div class="rs-mini">
                {% if clinic.address or clinic.city %}
                  <span class="rs-mini-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>{{ clinic.address }}{% if clinic.address and clinic.city %}, {% endif %}{{ clinic.city }}</span>
                  </span>
                {% endif %}
                {% if clinic.phone or clinic.phone_number %}
                  <span class="rs-mini-item">
                    <i class="fas fa-phone-alt"></i>
                    <span>{{ clinic.phone or clinic.phone_number }}</span>
                  </span>
                {% endif %}
              </div>
            </div>
          </div>

            <div class="rs-hero-bottom">
              <div class="rs-kpis">
                <div class="rs-kpi">
                  <div class="rs-kpi-icon"><i class="fas fa-user-md"></i></div>
                  <div>
                    <div class="rs-kpi-value">{{ clinic_doctors|length }}</div>
                    <div class="rs-kpi-label">Doctors</div>
                  </div>
                </div>

                <div class="rs-kpi rs-kpi--soft">
                  <div class="rs-kpi-icon"><i class="fas fa-bolt"></i></div>
                  <div>
                    <div class="rs-kpi-value">{{ 'Online' if has_online_booking else 'Call' }}</div>
                    <div class="rs-kpi-label">{{ 'Booking Ready' if has_online_booking else 'to Book' }}</div>
                  </div>
                </div>
              </div>

              {% if not has_doctors %}
              <div class="rs-empty-banner">
                <i class="fas fa-info-circle"></i>
                <span>Doctor listings are being added. Check back soon.</span>
              </div>
              {% endif %}

              <div class="rs-hero-actions">
                {% set full_address = [clinic.name, clinic.address, clinic.city, 'Nepal']|select|join(', ') %}
                {% if has_doctors %}
                  {% if has_online_booking %}
                    <a href="#doctors" class="rs-btn rs-btn--primary">
                    <i class="fas fa-calendar-check"></i> Book an Appointment
                  </a>
                {% else %}
                  <a href="#doctors" class="rs-btn rs-btn--primary">
                    <i class="fas fa-user-md"></i> View Doctors
                  </a>
                {% endif %}
                {% if clinic.phone or clinic.phone_number %}
                <a href="tel:{{ clinic.phone or clinic.phone_number }}" class="rs-btn rs-btn--outline">
                  <i class="fas fa-phone-alt"></i> Call Clinic
                </a>
                {% endif %}
              {% else %}
                {% if clinic.phone or clinic.phone_number %}
                <a href="tel:{{ clinic.phone or clinic.phone_number }}" class="rs-btn rs-btn--primary">
                  <i class="fas fa-phone-alt"></i> Call Clinic
                </a>
                {% else %}
                <a href="https://www.google.com/maps/search/?api=1&query={{ full_address|urlencode }}"
                   target="_blank" rel="noopener"
                   class="rs-btn rs-btn--primary">
                  <i class="fas fa-directions"></i> Directions
                </a>
                {% endif %}
              {% endif %}
              <a href="https://www.google.com/maps/search/?api=1&query={{ full_address|urlencode }}"
                 target="_blank" rel="noopener"
                 class="rs-btn rs-btn--ghost">
                <i class="fas fa-directions"></i> Directions
              </a>
            </div>
          </div>
        </div>

        <!-- CONTACT / TRUST PANEL -->
        <aside class="rs-side">
          <div class="rs-side-card">
            <div class="rs-side-title">
              <div class="rs-side-icon"><i class="fas fa-headset"></i></div>
              <div>
                <div class="rs-side-h">Clinic Contacts</div>
                <div class="rs-side-sub">Fast access for patients</div>
              </div>
            </div>

            <div class="rs-side-list">
              {% if clinic.address or clinic.city %}
              <div class="rs-side-row">
                <i class="fas fa-map-marker-alt"></i>
                <div class="rs-side-text">
                  <div class="rs-side-label">Location</div>
                  <div class="rs-side-value">{{ clinic.address }}{% if clinic.address and clinic.city %}, {% endif %}{{ clinic.city }}</div>
                </div>
              </div>
              {% endif %}

              {% if clinic.phone or clinic.phone_number %}
              <a class="rs-side-row rs-side-row--link" href="tel:{{ clinic.phone or clinic.phone_number }}">
                <i class="fas fa-phone-alt"></i>
                <div class="rs-side-text">
                  <div class="rs-side-label">Phone</div>
                  <div class="rs-side-value">{{ clinic.phone or clinic.phone_number }}</div>
                </div>
                <span class="rs-side-chip">Tap to call</span>
              </a>
              {% endif %}

              {% if clinic.email %}
              <a class="rs-side-row rs-side-row--link" href="mailto:{{ clinic.email }}">
                <i class="fas fa-envelope"></i>
                <div class="rs-side-text">
                  <div class="rs-side-label">Email</div>
                  <div class="rs-side-value">{{ clinic.email }}</div>
                </div>
                <span class="rs-side-chip">Send</span>
              </a>
              {% endif %}

              {% if clinic.website %}
              <a class="rs-side-row rs-side-row--link" href="{{ clinic.website }}" target="_blank" rel="noopener">
                <i class="fas fa-globe"></i>
                <div class="rs-side-text">
                  <div class="rs-side-label">Website</div>
                  <div class="rs-side-value">Visit site</div>
                </div>
                <span class="rs-side-chip">Open</span>
              </a>
              {% endif %}

              {% set full_address2 = [clinic.name, clinic.address, clinic.city, 'Nepal']|select|join(', ') %}
              <a class="rs-side-row rs-side-row--cta"
                 href="https://www.google.com/maps/search/?api=1&query={{ full_address2|urlencode }}"
                 target="_blank" rel="noopener">
                <i class="fas fa-map-marked-alt"></i>
                <div class="rs-side-text">
                  <div class="rs-side-label">Navigation</div>
                  <div class="rs-side-value">Open in Google Maps</div>
                </div>
                <span class="rs-side-chip rs-side-chip--white">Go</span>
              </a>
            </div>
          </div>

          <div class="rs-side-card rs-side-card--trust">
            <div class="rs-trust">
              <div class="rs-trust-item">
                <div class="rs-trust-dot"><i class="fas fa-check"></i></div>
                <div>
                  <div class="rs-trust-h">Verified doctors</div>
                  <div class="rs-trust-p">Only approved profiles can appear here.</div>
                </div>
              </div>

              <div class="rs-trust-item">
                <div class="rs-trust-dot"><i class="fas fa-clock"></i></div>
                <div>
                  <div class="rs-trust-h">Clear schedules</div>
                  <div class="rs-trust-p">Patients see availability before booking.</div>
                </div>
              </div>

              <div class="rs-trust-item">
                <div class="rs-trust-dot"><i class="fas fa-shield-alt"></i></div>
                <div>
                  <div class="rs-trust-h">Clinic-first experience</div>
                  <div class="rs-trust-p">Designed to look premium and trustworthy.</div>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </header>

  <!-- VALUE STRIP -->
  {% if has_doctors %}
  <section class="rs-value">
    <div class="container">
      <div class="rs-value-card">
        <div class="rs-value-item">
          <div class="rs-value-icon"><i class="fas fa-calendar-check"></i></div>
          <div>
            <div class="rs-value-h">Instant booking</div>
            <div class="rs-value-p">Patients pick verified slots instantly.</div>
          </div>
        </div>
        <div class="rs-value-item">
          <div class="rs-value-icon"><i class="fas fa-user-shield"></i></div>
          <div>
            <div class="rs-value-h">Clinic-first listing</div>
            <div class="rs-value-p">Managed by your clinic team.</div>
          </div>
        </div>
        <div class="rs-value-item">
          <div class="rs-value-icon"><i class="fas fa-headset"></i></div>
          <div>
            <div class="rs-value-h">RankSewa booking</div>
            <div class="rs-value-p">Premium experience for your patients.</div>
          </div>
        </div>
      </div>
    </div>
  </section>
  {% else %}
  <section class="rs-value rs-value--empty">
    <div class="container">
      <div class="rs-empty-strip">
        <div>
          <div class="rs-empty-strip-title">Clinic setup in progress</div>
          <div class="rs-empty-strip-text">Doctors and schedules will appear here soon.</div>
        </div>
        <div class="rs-empty-strip-actions">
          {% if clinic.phone or clinic.phone_number %}
          <a href="tel:{{ clinic.phone or clinic.phone_number }}" class="rs-btn rs-btn--primary">
            <i class="fas fa-phone-alt"></i> Call Clinic
          </a>
          {% endif %}
          <a href="{{ url_for('clinics') }}" class="rs-btn rs-btn--outline">
            <i class="fas fa-hospital"></i> Browse Clinics
          </a>
        </div>
      </div>
    </div>
  </section>
  {% endif %}

  <!-- DOCTORS -->
  <section class="rs-section" id="doctors">
    <div class="container">
      <div class="rs-section-head">
        <div>
          <h2 class="rs-h2"><i class="fas fa-user-md"></i> Our Doctors</h2>
          <p class="rs-muted">Meet our verified healthcare professionals. Book online when schedules are available.</p>
        </div>
        <div class="rs-pill">
          <i class="fas fa-layer-group"></i>
          <span>{{ clinic_doctors|length }} listed</span>
        </div>
      </div>

      {% if clinic_doctors %}
      <p class="rs-muted-sm" style="margin-top: -0.75rem; margin-bottom: 1rem;">
        <i class="fas fa-shield-alt me-1" style="color: var(--brand);"></i>
        Doctors listed here are individually verified and have approved their association with this clinic.
      </p>
      <div class="rs-grid">
        {% for cd in clinic_doctors %}
        <article class="rs-card">
          <div class="rs-card-top">
            <div class="rs-doc">
              {% if cd.doctor.photo_url %}
                {% set photo_path = cd.doctor.photo_url.replace('photos/', '') %}
                <img src="{{ url_for('serve_photo', filename=photo_path) }}"
                     alt="{{ cd.doctor.name }}"
                     class="rs-avatar"
                     loading="lazy">
              {% else %}
                {% set name_parts = cd.doctor.name.replace('Dr. ', '').replace('Dr.', '').split() %}
                {% set initials = name_parts[0][:1] ~ (name_parts[-1][:1] if name_parts|length > 1 else '') %}
                <div class="rs-avatar rs-avatar--placeholder" aria-label="{{ cd.doctor.name }}">
                  {{ initials|upper }}
                </div>
              {% endif %}

              <div class="rs-doc-meta">
                <h3 class="rs-doc-name">
                  <a href="{{ url_for('doctor_profile', slug=cd.doctor.slug) }}">
                    {{ cd.doctor.name }}
                  </a>
                </h3>
                <div class="rs-doc-sub">
                  <span class="rs-spec">
                    <i class="fas fa-stethoscope"></i>
                    {{ cd.doctor.specialty.name if cd.doctor.specialty else 'General Physician' }}
                  </span>

                  {% if cd.role and cd.role != 'consultant' %}
                  <span class="rs-role">
                    <i class="fas fa-id-badge"></i> {{ cd.role|title }}
                  </span>
                  {% endif %}
                </div>

                {% if cd.doctor.is_verified %}
                <div class="rs-verify">
                  <i class="fas fa-check-circle"></i> Verified doctor
                </div>
                {% endif %}
              </div>
            </div>

            <div class="rs-card-kv">
              {% if cd.consultation_fee %}
              <div class="rs-fee">
                <div class="rs-fee-label">Consultation</div>
                <div class="rs-fee-value">NPR {{ cd.consultation_fee }}</div>
              </div>
              {% else %}
              <div class="rs-fee rs-fee--muted">
                <div class="rs-fee-label">Consultation</div>
                <div class="rs-fee-value">—</div>
              </div>
              {% endif %}
            </div>
          </div>

          {% set schedules = cd.get_schedules() %}
          {% if schedules %}
          <div class="rs-schedule">
            <div class="rs-schedule-head">
              <i class="fas fa-clock"></i>
              <span>Availability</span>
            </div>
            <div class="rs-chips">
              {% set days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'] %}
              {% for s in schedules %}
              <span class="rs-chip">
                {{ days[s.day_of_week] }} · {{ s.start_time.strftime('%I:%M %p').lstrip('0') }}
              </span>
              {% endfor %}
            </div>
          </div>
          {% else %}
          <div class="rs-schedule rs-schedule--empty">
            <div class="rs-schedule-head">
              <i class="fas fa-clock"></i>
              <span>Availability</span>
            </div>
            <div class="rs-muted-sm">Schedule not published yet.</div>
          </div>
          {% endif %}

          <div class="rs-actions">
            {% if schedules and cd.accepts_online_booking %}
            <a href="{{ url_for('clinic_book_appointment', clinic_slug=clinic.slug, doctor_id=cd.doctor.id) }}"
               class="rs-btn rs-btn--primary">
              <i class="fas fa-calendar-check"></i> Book Appointment
            </a>
            {% else %}
            <a href="{{ url_for('doctor_profile', slug=cd.doctor.slug) }}"
               class="rs-btn rs-btn--soft">
              <i class="fas fa-user"></i> View Profile
            </a>
            {% endif %}
          </div>
        </article>
        {% endfor %}
      </div>
      {% else %}
      <div class="rs-empty">
        <div class="rs-empty-icon"><i class="fas fa-user-md"></i></div>
        <h3>No Doctors Listed Yet</h3>
        <p>This clinic is listed on RankSewa. Doctors will appear once they are verified and approve their association.</p>
        <div class="rs-empty-actions">
          {% if clinic.phone or clinic.phone_number %}
          <a href="tel:{{ clinic.phone or clinic.phone_number }}" class="rs-btn rs-btn--primary">
            <i class="fas fa-phone-alt"></i> Call Clinic
          </a>
          {% endif %}
          <a href="{{ url_for('clinics') }}" class="rs-btn rs-btn--outline">
            <i class="fas fa-hospital"></i> Browse Clinics
          </a>
        </div>
      </div>
      {% endif %}
    </div>
  </section>

  <!-- LOCATION -->
  {% if clinic.address or clinic.city %}
  <section class="rs-section rs-section--tight">
    <div class="container">
      <div class="rs-location">
        <div class="rs-location-left">
          <h3 class="rs-h3"><i class="fas fa-hospital"></i> Visit Us</h3>
          <div class="rs-location-body">
            <div class="rs-lrow">
              <div class="rs-licon"><i class="fas fa-map-marker-alt"></i></div>
              <div>
                <div class="rs-llabel">{{ clinic.name }}</div>
                <div class="rs-ltext">
                  {% if clinic.address %}{{ clinic.address }}<br>{% endif %}
                  {% if clinic.city %}{{ clinic.city }}, Nepal{% endif %}
                </div>
              </div>
            </div>

            {% if clinic.phone or clinic.phone_number %}
            <div class="rs-lrow">
              <div class="rs-licon"><i class="fas fa-phone-alt"></i></div>
              <div>
                <div class="rs-llabel">Phone</div>
                <div class="rs-ltext">
                  <a href="tel:{{ clinic.phone or clinic.phone_number }}" class="rs-link">
                    {{ clinic.phone or clinic.phone_number }}
                  </a>
                </div>
              </div>
            </div>
            {% endif %}
          </div>
        </div>

        <div class="rs-location-right">
          {% set full_address3 = [clinic.name, clinic.address, clinic.city, 'Nepal']|select|join(', ') %}
          <a href="https://www.google.com/maps/search/?api=1&query={{ full_address3|urlencode }}"
             target="_blank" rel="noopener"
             class="rs-btn rs-btn--outline rs-btn--wide">
            <i class="fas fa-map-marked-alt"></i> Open in Google Maps
          </a>
          <div class="rs-muted-sm rs-center">Tip: patients can save directions for later.</div>
        </div>
      </div>
    </div>
  </section>
  {% endif %}
</div>

{% if has_doctors %}
<div class="rs-sticky-cta" aria-hidden="true">
  {% if has_doctors %}
    {% if has_online_booking %}
    <a href="#doctors" class="rs-btn rs-btn--primary">
      <i class="fas fa-calendar-check"></i> Book Appointment
    </a>
    {% else %}
    <a href="#doctors" class="rs-btn rs-btn--primary">
      <i class="fas fa-user-md"></i> View Doctors
    </a>
    {% endif %}
    {% if clinic.phone or clinic.phone_number %}
    <a href="tel:{{ clinic.phone or clinic.phone_number }}" class="rs-btn rs-btn--outline">
      <i class="fas fa-phone-alt"></i> Call Clinic
    </a>
    {% endif %}
  {% else %}
    {% if clinic.phone or clinic.phone_number %}
    <a href="tel:{{ clinic.phone or clinic.phone_number }}" class="rs-btn rs-btn--primary">
      <i class="fas fa-phone-alt"></i> Call Clinic
    </a>
    {% else %}
    <a href="{{ url_for('clinics') }}" class="rs-btn rs-btn--primary">
      <i class="fas fa-hospital"></i> Browse Clinics
    </a>
    {% endif %}
  {% endif %}
</div>
{% endif %}

<style>
/* =========================================
   RankSewa Clinic Portal (Premium)
   - Drop-in replacement: same data/links/logic
   - Uses existing CSS vars: --brand, --brand-soft
========================================= */

.rs-clinic{
  font-family: "Source Sans 3", "Plus Jakarta Sans", sans-serif;
  background:
    radial-gradient(900px 450px at 20% -10%, rgba(4,130,136,.12), transparent 60%),
    radial-gradient(700px 420px at 85% 10%, rgba(4,92,97,.10), transparent 58%),
    linear-gradient(180deg, #f8fafc 0%, #f8fafc 40%, #f1f5f9 100%);
  min-height: 100vh;
  position: relative;
  overflow: hidden;
}
.rs-clinic > *{ position: relative; z-index: 1; }

/* HERO */
.rs-hero{
  padding: 1.5rem 0 2.5rem;
}
.rs-breadcrumb{ margin-bottom: 1rem; }
.rs-back{
  display:inline-flex; align-items:center; gap:.5rem;
  color:#64748b; text-decoration:none; font-weight:600;
  padding:.5rem .75rem; border-radius:999px;
  background: rgba(255,255,255,.7);
  border: 1px solid rgba(226,232,240,.9);
  backdrop-filter: blur(10px);
  transition: all .2s ease;
}
.rs-back:hover{ color: var(--brand); transform: translateY(-1px); box-shadow: 0 10px 25px rgba(15,23,42,.08); }

.rs-hero-grid{
  display:grid;
  grid-template-columns: 1.6fr .9fr;
  gap: 1.25rem;
  align-items: start;
}

.rs-hero-card{
  background: rgba(255,255,255,.85);
  border: 1px solid rgba(226,232,240,.9);
  border-radius: 20px;
  box-shadow: 0 25px 60px rgba(15,23,42,.10);
  overflow:hidden;
  position:relative;
}
.rs-hero-card:before{
  content:"";
  position:absolute; inset:-2px;
  background: linear-gradient(120deg, rgba(4,130,136,.30), rgba(4,92,97,.18), rgba(4,150,140,.18));
  filter: blur(18px);
  opacity:.6;
  z-index:0;
}
.rs-hero-card > *{ position:relative; z-index:1; }

.rs-hero-top{
  padding: 1.5rem 1.5rem 1.25rem;
  display:flex;
  gap: 1.25rem;
  align-items:flex-start;
}

.rs-logo{
  width: 96px; height: 96px; border-radius: 18px;
  background: white;
  border: 1px solid rgba(226,232,240,.95);
  display:flex; align-items:center; justify-content:center;
  overflow:hidden;
  box-shadow: 0 12px 30px rgba(15,23,42,.10);
  flex-shrink: 0;
}
.rs-logo img{ width:100%; height:100%; object-fit: contain; padding: 10px; }
.rs-logo--placeholder{
  background: linear-gradient(135deg, var(--brand) 0%, #0ea5e9 100%);
  border: none;
}
.rs-logo--placeholder span{
  color: #fff; font-size: 2rem; font-weight: 800; letter-spacing:.5px;
}

.rs-hero-meta{ min-width:0; flex:1; }
.rs-badges{ display:flex; gap:.5rem; flex-wrap:wrap; margin-bottom:.6rem; }
.rs-badge{
  display:inline-flex; align-items:center; gap:.4rem;
  padding: .35rem .7rem;
  border-radius: 999px;
  font-size: .75rem;
  font-weight: 800;
  letter-spacing: .35px;
  text-transform: uppercase;
  border: 1px solid rgba(226,232,240,.9);
  background: rgba(248,250,252,.9);
  color: #334155;
}
.rs-badge--verified{
  background: rgba(220,252,231,.9);
  border-color: rgba(134,239,172,.65);
  color: #166534;
}
.rs-title{
  margin:0 0 .5rem;
  font-size: clamp(1.5rem, 2.4vw, 2.2rem);
  line-height:1.15;
  font-weight: 900;
  color:#0f172a;
  letter-spacing: -.3px;
  font-family: "Fraunces", "Playfair Display", serif;
}
.rs-subtitle{
  margin:0 0 .65rem;
  color:#475569;
  font-size: 1rem;
  line-height: 1.55;
  max-width: 56ch;
  overflow-wrap: anywhere;
}
.rs-description{ position: relative; }
.rs-desc-toggle{
  display:inline-flex;
  align-items:center;
  gap:.35rem;
  border: none;
  background: transparent;
  color: var(--brand);
  font-weight: 900;
  font-size: .9rem;
  padding: 0;
}
.rs-desc-toggle:focus{ outline: 3px solid rgba(4,130,136,.25); outline-offset: 2px; }
.rs-desc-toggle:hover{ color:#0f172a; }
.rs-mini{
  display:flex; flex-wrap:wrap; gap:.75rem 1rem;
  margin-top:.25rem;
}
.rs-mini-item{
  display:inline-flex; align-items:center; gap:.5rem;
  color:#475569; font-weight:600; font-size:.9rem;
}
.rs-mini-item i{ color: var(--brand); width: 16px; text-align:center; }

.rs-hero-bottom{
  border-top: 1px solid rgba(226,232,240,.9);
  padding: 1.1rem 1.5rem 1.4rem;
  display:flex;
  justify-content: space-between;
  gap: 1rem;
  align-items:center;
  background: rgba(255,255,255,.6);
}

.rs-kpis{ display:flex; gap:.75rem; flex-wrap:wrap; }
.rs-kpi{
  display:flex; gap:.75rem; align-items:center;
  padding: .75rem .9rem;
  border-radius: 16px;
  background: rgba(248,250,252,.9);
  border: 1px solid rgba(226,232,240,.9);
}
.rs-kpi--soft{
  background: rgba(236,254,255,.9);
  border-color: rgba(165,243,252,.8);
}
.rs-kpi-icon{
  width: 40px; height: 40px; border-radius: 14px;
  display:flex; align-items:center; justify-content:center;
  background: var(--brand-soft);
  color: var(--brand);
}
.rs-kpi-value{ font-size: 1.15rem; font-weight: 900; color:#0f172a; line-height:1; }
.rs-kpi-label{ font-size: .8rem; color:#64748b; font-weight:700; margin-top:.15rem; }

.rs-hero-actions{
  display:flex; gap:.65rem;
  align-items:center;
}
.rs-empty-banner{
  display:inline-flex;
  align-items:center;
  gap:.5rem;
  padding:.5rem .8rem;
  border-radius: 999px;
  border: 1px solid rgba(226,232,240,.9);
  background: rgba(248,250,252,.95);
  color:#475569;
  font-weight:800;
  font-size:.82rem;
}
.rs-empty-banner i{ color: var(--brand); }
.rs-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:.55rem;
  padding:.75rem 1rem;
  border-radius: 14px;
  font-weight: 800;
  text-decoration:none;
  border: 1px solid rgba(226,232,240,.9);
  transition: all .2s ease;
  white-space: nowrap;
}
.rs-btn:focus{ outline: 3px solid rgba(4,130,136,.25); outline-offset: 2px; }
.rs-btn--primary{
  background: linear-gradient(135deg, var(--brand) 0%, #0ea5e9 100%);
  color: #fff;
  border: none;
  box-shadow: 0 14px 35px rgba(4,130,136,.22);
}
.rs-btn--primary:hover{ transform: translateY(-1px); box-shadow: 0 22px 48px rgba(4,130,136,.28); color:#fff; }
.rs-btn--outline{
  background: rgba(255,255,255,.9);
  color: #0f172a;
}
.rs-btn--outline:hover{ transform: translateY(-1px); box-shadow: 0 14px 35px rgba(15,23,42,.10); color:#0f172a; }
.rs-btn--ghost{
  background: transparent;
  color:#64748b;
  border: 1px dashed rgba(226,232,240,.9);
}
.rs-btn--ghost:hover{
  color:#0f172a;
  border-color: rgba(15,23,42,.18);
  transform: translateY(-1px);
}
.rs-btn--soft{
  width: 100%;
  background: rgba(241,245,249,.95);
  color:#334155;
}
.rs-btn--soft:hover{ background: rgba(226,232,240,.95); color:#0f172a; transform: translateY(-1px); }
.rs-btn--wide{ width: 100%; }

.rs-side{ display:flex; flex-direction:column; gap: 1.25rem; }
.rs-side-card{
  background: rgba(255,255,255,.85);
  border: 1px solid rgba(226,232,240,.9);
  border-radius: 20px;
  box-shadow: 0 20px 55px rgba(15,23,42,.08);
  overflow:hidden;
}
.rs-side-title{
  display:flex; gap:.9rem; align-items:center;
  padding: 1.25rem 1.25rem 1rem;
  border-bottom: 1px solid rgba(226,232,240,.9);
  background: rgba(248,250,252,.8);
}
.rs-side-icon{
  width: 44px; height: 44px; border-radius: 16px;
  display:flex; align-items:center; justify-content:center;
  background: var(--brand-soft);
  color: var(--brand);
}
.rs-side-h{ font-weight: 900; color:#0f172a; line-height:1.1; }
.rs-side-sub{ color:#64748b; font-size:.85rem; font-weight:700; margin-top:.15rem; }

.rs-side-list{ padding: 1rem 1.25rem 1.25rem; display:flex; flex-direction:column; gap:.75rem; }
.rs-side-row{
  display:flex; gap:.75rem; align-items:flex-start;
  padding: .85rem .9rem;
  border-radius: 16px;
  border: 1px solid rgba(226,232,240,.9);
  background: rgba(255,255,255,.8);
  text-decoration:none;
  color: inherit;
  position:relative;
}
.rs-side-row i{ color: var(--brand); width: 18px; text-align:center; margin-top:.2rem; }
.rs-side-row--link:hover{ transform: translateY(-1px); box-shadow: 0 14px 35px rgba(15,23,42,.10); }
.rs-side-row--cta{
  background: linear-gradient(135deg, var(--brand) 0%, #0ea5e9 100%);
  border: none;
  color: #fff;
}
.rs-side-row--cta i{ color:#fff; }
.rs-side-text{ flex:1; min-width:0; }
.rs-side-label{ font-size:.78rem; color:#64748b; font-weight:900; text-transform:uppercase; letter-spacing:.35px; }
.rs-side-row--cta .rs-side-label{ color: rgba(255,255,255,.8); }
.rs-side-value{ color:#0f172a; font-weight:800; margin-top:.15rem; word-break: break-word; }
.rs-side-row--cta .rs-side-value{ color:#fff; }
.rs-side-chip{
  flex-shrink:0;
  align-self:center;
  font-size:.75rem;
  font-weight:900;
  padding:.25rem .55rem;
  border-radius: 999px;
  border: 1px solid rgba(226,232,240,.9);
  background: rgba(248,250,252,.9);
  color:#334155;
}
.rs-side-chip--white{
  border-color: rgba(255,255,255,.35);
  background: rgba(255,255,255,.18);
  color: #fff;
}

.rs-side-card--trust{
  padding: 1.1rem 1.25rem 1.25rem;
}
.rs-trust{ display:flex; flex-direction:column; gap: .9rem; }
.rs-trust-item{ display:flex; gap:.75rem; align-items:flex-start; }
.rs-trust-dot{
  width: 34px; height: 34px; border-radius: 14px;
  display:flex; align-items:center; justify-content:center;
  background: rgba(220,252,231,.9);
  color: #166534;
  border: 1px solid rgba(134,239,172,.65);
  flex-shrink:0;
}
.rs-trust-h{ font-weight: 900; color:#0f172a; line-height:1.2; }
.rs-trust-p{ color:#64748b; font-weight:700; font-size:.88rem; margin-top:.15rem; }

/* VALUE STRIP */
.rs-value{
  padding: 0 0 1.5rem;
}
.rs-value-card{
  background: rgba(255,255,255,.88);
  border: 1px solid rgba(226,232,240,.9);
  border-radius: 20px;
  box-shadow: 0 18px 45px rgba(15,23,42,.08);
  display:grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap: 1rem;
  padding: 1.1rem 1.25rem;
}
.rs-value--empty{
  padding: 0 0 1.25rem;
}
.rs-empty-strip{
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 1rem;
  padding: 1rem 1.25rem;
  border-radius: 16px;
  border: 1px solid rgba(226,232,240,.9);
  background: rgba(255,255,255,.9);
  box-shadow: 0 14px 35px rgba(15,23,42,.08);
}
.rs-empty-strip-title{
  font-weight: 900;
  color:#0f172a;
}
.rs-empty-strip-text{
  color:#64748b;
  font-weight:700;
  font-size:.92rem;
  margin-top:.2rem;
}
.rs-empty-strip-actions{
  display:flex;
  gap:.6rem;
  flex-wrap: wrap;
}
.rs-value-item{
  display:flex;
  gap:.75rem;
  align-items:flex-start;
  padding: .75rem;
  border-radius: 16px;
  background: rgba(248,250,252,.8);
  border: 1px solid rgba(226,232,240,.9);
}
.rs-value-icon{
  width: 42px; height: 42px; border-radius: 16px;
  display:flex; align-items:center; justify-content:center;
  background: var(--brand-soft);
  color: var(--brand);
  flex-shrink:0;
}
.rs-value-h{
  font-weight: 900;
  color:#0f172a;
  margin-bottom:.2rem;
}
.rs-value-p{
  color:#64748b;
  font-weight:700;
  font-size:.9rem;
}

/* SECTION */
.rs-section{ padding: 2.25rem 0 2.75rem; }
.rs-section--tight{ padding: 0 0 2.75rem; }

.rs-section-head{
  display:flex; justify-content:space-between; gap:1rem; align-items:flex-end;
  margin-bottom: 1.25rem;
}
.rs-h2{
  margin:0 0 .35rem;
  font-size: 1.55rem;
  font-weight: 950;
  color:#0f172a;
  letter-spacing:-.2px;
  display:flex; align-items:center; gap:.65rem;
  font-family: "Fraunces", "Playfair Display", serif;
}
.rs-h2 i{ color: var(--brand); }
.rs-muted{ margin:0; color:#64748b; font-weight:700; }
.rs-muted-sm{ color:#64748b; font-weight:700; font-size:.88rem; }
.rs-center{ text-align:center; }

.rs-pill{
  display:inline-flex; align-items:center; gap:.5rem;
  padding:.5rem .75rem;
  border-radius: 999px;
  background: rgba(255,255,255,.85);
  border: 1px solid rgba(226,232,240,.9);
  color:#334155;
  font-weight:900;
}

/* DOCTOR GRID + CARD */
.rs-grid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
  gap: 1.2rem;
}

.rs-card{
  background: #fff;
  border: 1px solid rgba(226,232,240,.9);
  border-radius: 20px;
  box-shadow: 0 18px 45px rgba(15,23,42,.08);
  overflow:hidden;
  transition: transform .2s ease, box-shadow .2s ease;
  display:flex;
  flex-direction:column;
}
.rs-card:hover{
  transform: translateY(-3px);
  box-shadow: 0 28px 70px rgba(15,23,42,.12);
  border-color: rgba(4,130,136,.5);
}

.rs-card-top{
  padding: 1.35rem 1.35rem 1rem;
  display:flex;
  gap: 1rem;
  justify-content: space-between;
  align-items:center;
}
.rs-doc{ display:flex; gap: 1rem; align-items:center; min-width:0; }
.rs-avatar{
  width: 104px; height:104px; border-radius: 0;
  object-fit: cover;
  border: 1px solid rgba(226,232,240,.9);
  box-shadow: 0 10px 28px rgba(15,23,42,.10);
  flex-shrink:0;
  background:#fff;
}
.rs-avatar--placeholder{
  display:flex; align-items:center; justify-content:center;
  font-weight: 950;
  color: var(--brand);
  background: linear-gradient(135deg, rgba(4,130,136,.16) 0%, rgba(4,92,97,.10) 100%);
}

.rs-doc-meta{
  min-width:0;
  display:flex;
  flex-direction:column;
  gap:.35rem;
}
.rs-doc-name{
  margin:0;
  font-size: 1.05rem;
  font-weight: 950;
  line-height: 1.25;
}
.rs-doc-name a{ color:#0f172a; text-decoration:none; }
.rs-doc-name a:hover{ color: var(--brand); }
.rs-doc-sub{ display:flex; flex-wrap:wrap; gap:.45rem .75rem; }
.rs-spec, .rs-role{
  display:inline-flex; align-items:center; gap:.4rem;
  font-weight: 800;
  color:#475569;
  font-size:.88rem;
}
.rs-spec i, .rs-role i{ color: var(--brand); }

.rs-verify{
  margin-top:.15rem;
  display:inline-flex; align-items:center; gap:.4rem;
  font-weight: 900;
  font-size:.72rem;
  color:#047857;
  background: #ecfdf5;
  border: 1px solid #d1fae5;
  padding: .2rem .45rem;
  border-radius: 6px;
}
.rs-card-kv{ flex-shrink:0; align-self:center; }
.rs-fee{
  min-width: 110px;
  text-align:center;
  padding: .55rem .7rem;
  border-radius: 12px;
  border: 1px solid rgba(226,232,240,.9);
  background: #f8fafc;
}
.rs-fee--muted{ opacity:.85; }
.rs-fee-label{
  font-size:.65rem;
  font-weight: 950;
  letter-spacing:.35px;
  text-transform: uppercase;
  color:#64748b;
}
.rs-fee-value{
  margin-top:.15rem;
  font-weight: 950;
  color:#0f172a;
  font-size: .98rem;
}

/* SCHEDULE */
.rs-schedule{
  padding: 1rem 1.35rem 0;
  border-top: 1px dashed rgba(226,232,240,.9);
  background: transparent;
}
.rs-schedule--empty{ background: transparent; }
.rs-schedule-head{
  display:flex; align-items:center; gap:.5rem;
  font-weight: 900;
  color:#64748b;
  margin-bottom:.5rem;
  font-size:.72rem;
  letter-spacing:.35px;
  text-transform: uppercase;
}
.rs-schedule-head i{ color: var(--brand); }
.rs-chips{ display:flex; flex-wrap:wrap; gap:.45rem; }
.rs-chip{
  display:inline-flex; align-items:center;
  padding:.3rem .6rem;
  border-radius: 999px;
  border: 1px solid rgba(226,232,240,.9);
  background: rgba(248,250,252,.95);
  color:#334155;
  font-weight: 900;
  font-size:.82rem;
}
.rs-chip.is-hidden{ display:none; }
.rs-chip-toggle{
  background: #fff;
  border-style: dashed;
  color:#64748b;
  cursor: pointer;
}

/* ACTIONS */
.rs-actions{
  padding: 1.1rem 1.35rem 1.35rem;
  background: transparent;
  border-top: none;
}
.rs-actions .rs-btn{ width:100%; }
.rs-actions .rs-btn--primary{
  box-shadow: 0 16px 40px rgba(4,130,136,.22);
}
.rs-actions .rs-btn--primary:hover{ box-shadow: 0 24px 55px rgba(4,130,136,.28); }

/* EMPTY */
.rs-empty{
  text-align:center;
  padding: 2.5rem 2rem;
  background: rgba(255,255,255,.88);
  border: 1px solid rgba(226,232,240,.9);
  border-radius: 20px;
  box-shadow: 0 18px 50px rgba(15,23,42,.08);
}
.rs-empty-icon{
  width: 78px; height: 78px;
  margin: 0 auto 1.25rem;
  border-radius: 26px;
  display:flex; align-items:center; justify-content:center;
  background: var(--brand-soft);
  color: var(--brand);
  box-shadow: 0 16px 40px rgba(15,23,42,.10);
}
.rs-empty-icon i{ font-size: 1.9rem; }
.rs-empty-actions{
  margin-top: 1.2rem;
  display:flex;
  justify-content:center;
  gap:.6rem;
  flex-wrap: wrap;
}

/* LOCATION */
.rs-location{
  background: rgba(255,255,255,.88);
  border: 1px solid rgba(226,232,240,.9);
  border-radius: 20px;
  box-shadow: 0 20px 55px rgba(15,23,42,.08);
  padding: 1.5rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap: 1.25rem;
}
.rs-h3{
  margin:0 0 1rem;
  font-size: 1.15rem;
  font-weight: 950;
  color:#0f172a;
  display:flex; align-items:center; gap:.55rem;
  font-family: "Fraunces", "Playfair Display", serif;
}
.rs-h3 i{ color: var(--brand); }
.rs-location-body{ display:flex; flex-direction:column; gap:.9rem; }
.rs-lrow{ display:flex; gap:.75rem; align-items:flex-start; }
.rs-licon{
  width: 40px; height:40px; border-radius: 16px;
  display:flex; align-items:center; justify-content:center;
  background: rgba(248,250,252,.95);
  border: 1px solid rgba(226,232,240,.9);
  color: var(--brand);
  flex-shrink:0;
}
.rs-llabel{ font-weight: 950; color:#0f172a; }
.rs-ltext{ color:#475569; font-weight: 800; line-height:1.55; }
.rs-link{ color:#0f172a; text-decoration:none; font-weight: 950; }
.rs-link:hover{ color: var(--brand); }
.rs-location-right{ min-width: 260px; display:flex; flex-direction:column; gap:.6rem; }

/* STICKY CTA */
.rs-sticky-cta{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  padding: .75rem 1rem 1rem;
  background: rgba(248,250,252,.94);
  border-top: 1px solid rgba(226,232,240,.9);
  box-shadow: 0 -12px 35px rgba(15,23,42,.08);
  display:none;
  z-index: 50;
  gap: .5rem;
  flex-direction: column;
}
.rs-sticky-cta .rs-btn{ width:100%; }
.rs-sticky-cta.is-hidden{
  transform: translateY(120%);
  transition: transform .25s ease;
}

/* MOBILE */
@media (max-width: 992px){
  .rs-hero-grid{ grid-template-columns: 1fr; }
  .rs-location-right{ min-width: 0; width:100%; }
  .rs-value-card{ grid-template-columns: 1fr; }
}

@media (max-width: 768px){
  .rs-description:not(.is-expanded) .rs-subtitle{
    -webkit-line-clamp: 4;
  }
  .rs-hero-top{ flex-direction: column; align-items: center; text-align:center; }
  .rs-hero-actions{ width:100%; flex-direction: column; }
  .rs-hero-actions .rs-btn{ width:100%; }
  .rs-kpis{ width:100%; justify-content:center; }
  .rs-hero-bottom{ flex-direction: column; align-items: stretch; }
  .rs-empty-banner{ justify-content:center; }
  .rs-fee{ min-width: 0; text-align:left; width:100%; }
  .rs-card-top{ flex-direction: column; align-items:flex-start; }
  .rs-doc{ width:100%; }
  .rs-card-kv{ width:100%; order: 3; }
  .rs-fee{ text-align:left; }
  .rs-grid{ grid-template-columns: 1fr; }
  .rs-location{ flex-direction: column; text-align:left; }
  .rs-location-left, .rs-location-right{ width:100%; }
  .rs-location-right{ align-items:flex-start; text-align:left; }
  .rs-sticky-cta{ display:block; }
  body{ padding-bottom: 90px; }
}

.rs-description:not(.is-expanded) .rs-subtitle{
  display: -webkit-box;
  -webkit-line-clamp: 6;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.rs-clinic--empty .rs-hero{ padding: 1.1rem 0 1.75rem; }
.rs-clinic--empty .rs-section{ padding: 1.6rem 0 2rem; }
.rs-clinic--empty .rs-section--tight{ padding: 0 0 2rem; }
@media (max-width: 768px){
  .rs-empty-strip{
    flex-direction: column;
    align-items:flex-start;
  }
  .rs-empty-strip-actions{
    width:100%;
  }
  .rs-empty-strip-actions .rs-btn{
    width:100%;
  }
}
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll('[data-role="clinic-description"]').forEach((wrapper) => {
      const subtitle = wrapper.querySelector(".rs-subtitle");
      const toggle = wrapper.querySelector(".rs-desc-toggle");
      if (!subtitle || !toggle) return;

      const isOverflowing = subtitle.scrollHeight > subtitle.clientHeight + 2;
      if (!isOverflowing) {
        toggle.style.display = "none";
        return;
      }

      toggle.addEventListener("click", () => {
        const expanded = wrapper.classList.toggle("is-expanded");
        toggle.setAttribute("aria-expanded", expanded ? "true" : "false");
        toggle.textContent = expanded ? "Show less" : "Read more";
      });
    });

    const collapseScheduleChips = () => {
      const isMobile = window.matchMedia("(max-width: 768px)").matches;
      document.querySelectorAll(".rs-chips").forEach((chips) => {
        const items = Array.from(chips.querySelectorAll(".rs-chip"));
        const existingToggle = chips.querySelector(".rs-chip-toggle");
        items.forEach((item) => item.classList.remove("is-hidden"));
        if (existingToggle) existingToggle.remove();
        if (!isMobile || items.length <= 3) return;

        items.slice(3).forEach((item) => item.classList.add("is-hidden"));
        const toggle = document.createElement("button");
        toggle.type = "button";
        toggle.className = "rs-chip rs-chip-toggle";
        toggle.textContent = `+${items.length - 3} more`;
        toggle.addEventListener("click", () => {
          const expanded = toggle.getAttribute("data-expanded") === "true";
          if (expanded) {
            items.slice(3).forEach((item) => item.classList.add("is-hidden"));
            toggle.textContent = `+${items.length - 3} more`;
            toggle.setAttribute("data-expanded", "false");
          } else {
            items.slice(3).forEach((item) => item.classList.remove("is-hidden"));
            toggle.textContent = "Show less";
            toggle.setAttribute("data-expanded", "true");
          }
        });
        chips.appendChild(toggle);
      });
    };

    const stickyCta = document.querySelector(".rs-sticky-cta");
    const doctorsSection = document.querySelector("#doctors");
    if (stickyCta && doctorsSection) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              stickyCta.classList.add("is-hidden");
              stickyCta.setAttribute("aria-hidden", "true");
            } else {
              stickyCta.classList.remove("is-hidden");
              stickyCta.setAttribute("aria-hidden", "false");
            }
          });
        },
        { root: null, threshold: 0.2 }
      );
      observer.observe(doctorsSection);
    }

    collapseScheduleChips();
    window.addEventListener("resize", () => {
      clearTimeout(window.__rsResizeTimer);
      window.__rsResizeTimer = setTimeout(collapseScheduleChips, 150);
    });
  });
</script>
{% endblock %}
