{% extends "base.html" %}

{% block title %}Claim Profile: {{ doctor.name }} - RankSewa{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <!-- Doctor Info Card -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h4 class="card-title mb-3">
                    <i class="fas fa-user-md me-2"></i>Claiming Profile For:
                </h4>
                <div class="d-flex align-items-center">
                    {% if doctor.photo_url %}
                    <img src="{{ url_for('serve_photo', filename=doctor.photo_url) }}" alt="{{ doctor.name }}" class="rounded-circle me-3" width="80" height="80" onerror="this.src='{{ doctor|doctor_avatar }}'">
                    {% else %}
                    <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3" style="width: 80px; height: 80px;">
                        <i class="fas fa-user-md fa-2x"></i>
                    </div>
                    {% endif %}
                    <div>
                        <h5 class="mb-1">{{ doctor.name }}</h5>
                        <p class="mb-0 text-muted">
                            {{ doctor.specialty.name }} â€¢ {{ doctor.city.name }}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Verification Form -->
        <div class="card shadow-sm">
            <div class="card-body p-4">
                <h4 class="card-title mb-4">
                    <i class="fas fa-clipboard-check me-2"></i>Verification Information
                </h4>

                <p class="text-muted mb-4">
                    Please provide the following information to verify your identity and claim this profile.
                    All information will be reviewed by our admin team.
                </p>

                <form method="POST" action="{{ url_for('claim_profile_submit', doctor_id=doctor.id) }}" enctype="multipart/form-data">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                    <!-- NMC Number -->
                    <div class="mb-4">
                        <label for="nmc_number" class="form-label">
                            <i class="fas fa-id-card me-2"></i>Nepal Medical Council (NMC) Registration Number *
                        </label>
                        <input type="text"
                               class="form-control"
                               id="nmc_number"
                               name="nmc_number"
                               placeholder="e.g., NMC-12345"
                               required>
                        <small class="form-text text-muted">
                            Your official NMC registration number
                        </small>
                    </div>

                    <!-- Phone Number -->
                    <div class="mb-4">
                        <label for="phone_number" class="form-label">
                            <i class="fas fa-phone me-2"></i>Phone Number *
                        </label>
                        <input type="tel"
                               class="form-control"
                               id="phone_number"
                               name="phone_number"
                               placeholder="+977 98XXXXXXXX"
                               required>
                        <small class="form-text text-muted">
                            We'll use this to verify your identity
                        </small>
                    </div>

                    <!-- Email -->
                    <div class="mb-4">
                        <label for="email" class="form-label">
                            <i class="fas fa-envelope me-2"></i>Email Address *
                        </label>
                        <input type="email"
                               class="form-control"
                               id="email"
                               name="email"
                               value="{{ current_user.email if current_user }}"
                               {% if current_user %}readonly{% endif %}
                               required>
                        <small class="form-text text-muted">
                            {% if current_user %}
                            Using your registered email address
                            {% else %}
                            Professional email address for verification
                            {% endif %}
                        </small>
                    </div>

                    <!-- Practice Address -->
                    <div class="mb-4">
                        <label for="practice_address" class="form-label">
                            <i class="fas fa-map-marker-alt me-2"></i>Practice Address *
                        </label>
                        <textarea class="form-control"
                                  id="practice_address"
                                  name="practice_address"
                                  rows="2"
                                  placeholder="Your clinic/hospital address"
                                  required></textarea>
                    </div>

                    <!-- Practice City -->
                    <div class="mb-4">
                        <label for="practice_city_id" class="form-label">
                            <i class="fas fa-city me-2"></i>Practice City *
                        </label>
                        <select class="form-select" id="practice_city_id" name="practice_city_id" required>
                            <option value="">Select city...</option>
                            {% for city in cities %}
                            <option value="{{ city.id }}" {% if city.id == doctor.city_id %}selected{% endif %}>
                                {{ city.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <hr class="my-4">

                    <h5 class="mb-3"><i class="fas fa-upload me-2"></i>Document Upload</h5>
                    <p class="text-muted small mb-4">
                        Upload a government-issued ID to verify your identity.
                        Accepted formats: JPG, PNG, PDF (max 10MB)
                    </p>

                    <!-- Government ID Upload -->
                    <div class="mb-4">
                        <label for="govt_id" class="form-label">
                            <i class="fas fa-id-card me-2"></i>Government ID (Citizenship/Passport/License) *
                        </label>
                        <input type="file"
                               class="form-control"
                               id="govt_id"
                               name="govt_id"
                               accept=".jpg,.jpeg,.png,.pdf"
                               required>
                        <small class="form-text text-muted">
                            Upload a clear photo of your citizenship, passport, or driver's license
                        </small>
                    </div>

                    <!-- Optional Documents -->
                    <div class="alert alert-light border">
                        <h6 class="mb-2"><i class="fas fa-lightbulb me-2"></i>Speed Up Verification (Optional)</h6>
                        <small class="text-muted">
                            Adding medical degree or practice license documents helps us verify you faster, but they're not required.
                        </small>
                    </div>

                    <!-- Medical Degree Upload (Optional) -->
                    <div class="mb-4">
                        <label for="medical_degree" class="form-label">
                            <i class="fas fa-graduation-cap me-2"></i>Medical Degree Certificate (Optional)
                        </label>
                        <input type="file"
                               class="form-control"
                               id="medical_degree"
                               name="medical_degree"
                               accept=".jpg,.jpeg,.png,.pdf">
                        <small class="form-text text-muted">
                            Helps us verify you faster
                        </small>
                    </div>

                    <!-- Practice License Upload (Optional) -->
                    <div class="mb-4">
                        <label for="practice_license" class="form-label">
                            <i class="fas fa-certificate me-2"></i>Practice License (Optional)
                        </label>
                        <input type="file"
                               class="form-control"
                               id="practice_license"
                               name="practice_license"
                               accept=".jpg,.jpeg,.png,.pdf">
                        <small class="form-text text-muted">
                            Helps us verify you faster
                        </small>
                    </div>

                    <hr class="my-4">

                    <!-- Privacy Notice -->
                    <div class="alert alert-info">
                        <h6><i class="fas fa-shield-alt me-2"></i>Privacy & Security</h6>
                        <small>
                            Your documents will be securely stored and only reviewed by our admin team for verification purposes.
                            We will never share your personal documents with third parties.
                        </small>
                    </div>

                    <!-- Age Verification -->
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="age_confirm" required>
                        <label class="form-check-label" for="age_confirm">
                            I confirm that I am at least 16 years old
                        </label>
                    </div>

                    <!-- Terms and Conditions Agreement -->
                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" id="terms_agree" required>
                        <label class="form-check-label" for="terms_agree">
                            I certify that all information provided is accurate and I agree to RankSewa's
                            <a href="{{ url_for('terms') }}" target="_blank">Terms of Service</a> and
                            <a href="{{ url_for('privacy') }}" target="_blank">Privacy Policy</a>
                        </label>
                    </div>

                    <!-- Submit Buttons -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-paper-plane me-2"></i>Submit for Verification
                        </button>
                        <a href="{{ url_for('claim_profile') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Search
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- What Happens Next -->
        <div class="card shadow-sm mt-4">
            <div class="card-body">
                <h5 class="card-title mb-3">
                    <i class="fas fa-info-circle me-2"></i>What Happens Next?
                </h5>
                <ol class="mb-0">
                    <li class="mb-2">Your verification request will be submitted to our admin team</li>
                    <li class="mb-2">We'll review your documents and information (usually within 2-3 business days)</li>
                    <li class="mb-2">You'll receive an email notification once your profile is verified</li>
                    <li class="mb-0">After verification, you can log in to manage your profile and respond to reviews</li>
                </ol>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// File size validation
document.querySelectorAll('input[type="file"]').forEach(input => {
    input.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                alert('File size exceeds 10MB. Please upload a smaller file.');
                this.value = '';
            }
        }
    });
});

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const govtIdInput = document.getElementById('govt_id');

    if (!govtIdInput.files || govtIdInput.files.length === 0) {
        e.preventDefault();
        alert('Please upload your Government ID to continue');
        return false;
    }
});
</script>
{% endblock %}
