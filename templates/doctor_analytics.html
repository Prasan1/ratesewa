{% extends "base.html" %}

{% block title %}Analytics - Doctor Dashboard - RankSewa{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-10 offset-lg-1">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>
                    <i class="fas fa-chart-bar me-2"></i>
                    {% if viewer_role == 'clinic_manager' %}
                    Clinic Manager Analytics
                    {% else %}
                    Profile Analytics
                    {% endif %}
                </h2>
                <a href="{% if viewer_role == 'clinic_manager' %}{{ url_for('clinic_manager_dashboard') }}{% else %}{{ url_for('doctor_dashboard') }}{% endif %}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                </a>
            </div>

            {% if viewer_role == 'clinic_manager' %}
            <div class="alert alert-info">
                Focus on appointment growth: faster responses, more reviews, and stronger profile signals improve booking rates.
            </div>
            {% endif %}

            <!-- 30-Day Performance Overview -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="card shadow-sm h-100" style="border-left: 4px solid #7B2CBF;">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted mb-1">30-Day Views</p>
                                    <h3 class="mb-0">{{ "{:,}".format(total_views_30d or 0) }}</h3>
                                    <small class="text-success">
                                        <i class="fas fa-arrow-up"></i> {{ "%.1f"|format(avg_daily_views or 0) }}/day
                                    </small>
                                </div>
                                <i class="fas fa-chart-line fa-2x" style="color: #7B2CBF; opacity: 0.3;"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-3 mb-3">
                    <div class="card shadow-sm h-100" style="border-left: 4px solid #3AA76D;">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted mb-1">Search Appearances</p>
                                    <h3 class="mb-0">{{ "{:,}".format(total_search_appearances or 0) }}</h3>
                                    <small class="text-muted">Times shown in results</small>
                                </div>
                                <i class="fas fa-search fa-2x" style="color: #3AA76D; opacity: 0.3;"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-3 mb-3">
                    <div class="card shadow-sm h-100" style="border-left: 4px solid #FF6B35;">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted mb-1">Phone Clicks</p>
                                    <h3 class="mb-0">{{ "{:,}".format(total_phone_clicks or 0) }}</h3>
                                    <small class="text-muted">Patient contact actions</small>
                                </div>
                                <i class="fas fa-phone fa-2x" style="color: #FF6B35; opacity: 0.3;"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-3 mb-3">
                    <div class="card shadow-sm h-100" style="border-left: 4px solid #1982C4;">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted mb-1">Total Reviews</p>
                                    <h3 class="mb-0">{{ "{:,}".format(review_count or 0) }}</h3>
                                    <small class="text-muted">Patient feedback</small>
                                </div>
                                <i class="fas fa-comments fa-2x" style="color: #1982C4; opacity: 0.3;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Traffic Sources Breakdown -->
            <div class="row mb-4">
                <div class="col-md-6 mb-3">
                    <div class="card shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><i class="fas fa-traffic-light me-2"></i>Traffic Sources (Last 30 Days)</h5>
                        </div>
                        <div class="card-body">
                            {% set total_traffic = traffic_sources.search + traffic_sources.google + traffic_sources.homepage + traffic_sources.direct %}
                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span><i class="fas fa-search me-2 text-primary"></i> Internal Search</span>
                                    <strong>{{ traffic_sources.search }}</strong>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-primary" style="width: {{ (traffic_sources.search / total_traffic * 100) if total_traffic > 0 else 0 }}%"></div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span><i class="fab fa-google me-2 text-success"></i> Google Search</span>
                                    <strong>{{ traffic_sources.google }}</strong>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-success" style="width: {{ (traffic_sources.google / total_traffic * 100) if total_traffic > 0 else 0 }}%"></div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span><i class="fas fa-home me-2 text-warning"></i> Homepage</span>
                                    <strong>{{ traffic_sources.homepage }}</strong>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-warning" style="width: {{ (traffic_sources.homepage / total_traffic * 100) if total_traffic > 0 else 0 }}%"></div>
                                </div>
                            </div>

                            <div>
                                <div class="d-flex justify-content-between align-items-center mb-1">
                                    <span><i class="fas fa-link me-2 text-info"></i> Direct Link</span>
                                    <strong>{{ traffic_sources.direct }}</strong>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-info" style="width: {{ (traffic_sources.direct / total_traffic * 100) if total_traffic > 0 else 0 }}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <div class="card shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><i class="fas fa-chart-area me-2"></i>Profile Views Trend</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="viewsChart" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Overview Cards -->
            <div class="row mb-4">
                <div class="col-md-4 mb-3">
                    <div class="card shadow-sm h-100 border-primary">
                        <div class="card-body text-center">
                            <i class="fas fa-eye fa-3x text-primary mb-3"></i>
                            <h2 class="mb-0">{{ doctor.profile_views or 0 }}</h2>
                            <p class="text-muted mb-0">Total Profile Views</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-3">
                    <div class="card shadow-sm h-100 border-warning">
                        <div class="card-body text-center">
                            <i class="fas fa-comments fa-3x text-warning mb-3"></i>
                            <h2 class="mb-0">{{ review_count }}</h2>
                            <p class="text-muted mb-0">Total Reviews</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-3">
                    <div class="card shadow-sm h-100 border-success">
                        <div class="card-body text-center">
                            <i class="fas fa-star fa-3x text-success mb-3"></i>
                            <h2 class="mb-0">{{ "%.1f"|format(avg_rating) }}</h2>
                            <p class="text-muted mb-0">Average Rating</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Momentum Cards -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="card shadow-sm h-100 border-info">
                        <div class="card-body text-center">
                            <i class="fas fa-calendar-check fa-2x text-info mb-2"></i>
                            <h3 class="mb-0">{{ reviews_last_30|length }}</h3>
                            <p class="text-muted mb-0">Reviews in last 30 days</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card shadow-sm h-100 border-secondary">
                        <div class="card-body text-center">
                            <i class="fas fa-wave-square fa-2x text-secondary mb-2"></i>
                            {% set delta = (reviews_last_30|length) - (reviews_prev_30|length) %}
                            <h3 class="mb-0">
                                {% if delta > 0 %}
                                +{{ delta }}
                                {% elif delta < 0 %}
                                {{ delta }}
                                {% else %}
                                0
                                {% endif %}
                            </h3>
                            <p class="text-muted mb-0">Review momentum vs previous 30 days</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card shadow-sm h-100 border-success">
                        <div class="card-body text-center">
                            <i class="fas fa-star-half-alt fa-2x text-success mb-2"></i>
                            <h3 class="mb-0">{{ "%.1f"|format(avg_rating_last_90) }}</h3>
                            <p class="text-muted mb-0">Avg rating (last 90 days)</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card shadow-sm h-100 border-warning">
                        <div class="card-body text-center">
                            <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                            {% if average_response_hours is not none %}
                            {% if average_response_hours >= 24 %}
                            <h3 class="mb-0">{{ "%.1f"|format(average_response_hours / 24) }}d</h3>
                            {% else %}
                            <h3 class="mb-0">{{ "%.1f"|format(average_response_hours) }}h</h3>
                            {% endif %}
                            {% else %}
                            <h3 class="mb-0">--</h3>
                            {% endif %}
                            <p class="text-muted mb-0">Avg response time</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profile Strength -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><i class="fas fa-user-check me-2"></i>Profile Strength</h5>
                        </div>
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <div class="me-3">
                                    <h4 class="mb-0">{{ profile_strength_pct }}%</h4>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar bg-success" style="width: {{ profile_strength_pct }}%"></div>
                                    </div>
                                </div>
                            </div>
                            <p class="text-muted mb-2">More complete profiles get more trust and better engagement.</p>
                            {% if missing_profile_fields|length > 0 %}
                            {% set field_labels = {
                                'photo': 'Profile photo',
                                'bio': 'Bio',
                                'education': 'Education',
                                'workplace': 'Workplace',
                                'address': 'Practice address',
                                'phone': 'Phone number'
                            } %}
                            <div class="small">
                                Missing:
                                {% for field in missing_profile_fields[:3] %}
                                <span class="badge bg-light text-dark me-1">{{ field_labels.get(field, field) }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            <span class="badge bg-success">Complete</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Items -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-dark text-white">
                            <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>Next Actions to Grow</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-2">Quick Wins</h6>
                                    <ul class="mb-0">
                                        {% if unanswered_reviews|length > 0 %}
                                        <li>Reply to {{ unanswered_reviews|length }} recent review(s) to boost trust</li>
                                        {% endif %}
                                        {% if response_rate < 80 %}
                                        <li>Target an 80% response rate to improve patient confidence</li>
                                        {% endif %}
                                        {% if reviews_last_30|length == 0 %}
                                        <li>Ask recent patients to leave a review after visits</li>
                                        {% endif %}
                                        {% if unanswered_reviews|length == 0 and response_rate >= 80 and reviews_last_30|length > 0 %}
                                        <li>Keep the momentum—your engagement is strong this month</li>
                                        {% endif %}
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="mb-2">Profile Signals</h6>
                                    <ul class="mb-0">
                                        {% if not doctor.photo_url %}
                                        <li>Add a professional photo to increase profile trust</li>
                                        {% endif %}
                                        {% if not doctor.description %}
                                        <li>Write a short bio explaining your specialties and approach</li>
                                        {% endif %}
                                        {% if not doctor.workplace %}
                                        <li>List your workplace so patients can recognize you</li>
                                        {% endif %}
                                        {% if doctor.photo_url and doctor.description and doctor.workplace %}
                                        <li>Your profile looks complete—keep details up to date</li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                            <div class="mt-3">
                                {% if viewer_role == 'clinic_manager' %}
                                <a href="{{ url_for('doctor_profile', slug=doctor.slug) }}" class="btn btn-outline-primary me-2">
                                    <i class="fas fa-eye me-2"></i>View Public Profile
                                </a>
                                {% else %}
                                <a href="{{ url_for('doctor_reviews') }}" class="btn btn-outline-primary me-2">
                                    <i class="fas fa-reply me-2"></i>Respond to Reviews
                                </a>
                                <a href="{{ url_for('doctor_dashboard') }}" class="btn btn-outline-secondary">
                                    <i class="fas fa-user-edit me-2"></i>Edit Profile
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Featured Analytics -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header {% if has_enhanced_analytics %}bg-primary text-white{% else %}bg-light{% endif %}">
                            <h5 class="mb-0"><i class="fas fa-crown me-2"></i>Enhanced Analytics</h5>
                        </div>
                        <div class="card-body">
                            {% if has_enhanced_analytics %}
                            <div class="row">
                                <div class="col-md-7 mb-3">
                                    <h6 class="mb-3">Review Trend (Last 6 Months)</h6>
                                    <div class="table-responsive">
                                        <table class="table table-sm mb-0">
                                            <thead>
                                                <tr>
                                                    <th>Month</th>
                                                    <th>Reviews</th>
                                                    <th>Avg Rating</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for month in review_trend %}
                                                <tr>
                                                    <td>{{ month.label }}</td>
                                                    <td>{{ month.count }}</td>
                                                    <td>{{ "%.1f"|format(month.avg_rating) }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="col-md-5 mb-3">
                                    <h6 class="mb-3">Rating Trend</h6>
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="me-2">
                                            <span class="badge bg-success">{{ "%.1f"|format(avg_rating_last_90) }}</span>
                                        </div>
                                        <div>
                                            Avg rating last 90 days
                                        </div>
                                    </div>
                                    {% if rating_trend_delta is not none %}
                                    <div class="mb-3">
                                        {% if rating_trend_delta > 0 %}
                                        <span class="badge bg-success">+{{ "%.2f"|format(rating_trend_delta) }}</span>
                                        <span class="text-muted">vs previous 90 days</span>
                                        {% elif rating_trend_delta < 0 %}
                                        <span class="badge bg-danger">{{ "%.2f"|format(rating_trend_delta) }}</span>
                                        <span class="text-muted">vs previous 90 days</span>
                                        {% else %}
                                        <span class="badge bg-secondary">0.00</span>
                                        <span class="text-muted">vs previous 90 days</span>
                                        {% endif %}
                                    </div>
                                    {% else %}
                                    <p class="text-muted mb-3">Not enough data to compare trend.</p>
                                    {% endif %}
                                    <h6 class="mb-2">Response Speed</h6>
                                    {% if response_speed %}
                                    <div class="mb-2">Within 24h</div>
                                    <div class="progress mb-2" style="height: 12px;">
                                        <div class="progress-bar bg-success" style="width: {{ response_speed.within_24_pct }}%"></div>
                                    </div>
                                    <div class="mb-2">24-72h</div>
                                    <div class="progress mb-2" style="height: 12px;">
                                        <div class="progress-bar bg-warning" style="width: {{ response_speed.within_72_pct }}%"></div>
                                    </div>
                                    <div class="mb-2">Over 72h</div>
                                    <div class="progress" style="height: 12px;">
                                        <div class="progress-bar bg-danger" style="width: {{ response_speed.over_72_pct }}%"></div>
                                    </div>
                                    {% else %}
                                    <p class="text-muted mb-0">Response speed metrics will appear after you reply to reviews.</p>
                                    {% endif %}
                                </div>
                            </div>
                            {% else %}
                            <p class="mb-3">Enhanced analytics are available for Featured Premium doctors.</p>
                            <a href="{{ url_for('subscription_pricing') }}" class="btn btn-primary">
                                <i class="fas fa-arrow-up me-2"></i>Upgrade to Featured
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rating Breakdown -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-star me-2"></i>Rating Distribution</h5>
                        </div>
                        <div class="card-body">
                            {% if review_count > 0 %}
                            {% for stars in [5, 4, 3, 2, 1] %}
                            <div class="row mb-2 align-items-center">
                                <div class="col-md-2">
                                    <strong>{{ stars }} Stars</strong>
                                </div>
                                <div class="col-md-8">
                                    <div class="progress" style="height: 25px;">
                                        {% set percentage = (rating_breakdown[stars] / review_count * 100)|round(1) %}
                                        <div class="progress-bar {% if stars >= 4 %}bg-success{% elif stars == 3 %}bg-warning{% else %}bg-danger{% endif %}"
                                             role="progressbar"
                                             style="width: {{ percentage }}%"
                                             aria-valuenow="{{ rating_breakdown[stars] }}"
                                             aria-valuemin="0"
                                             aria-valuemax="{{ review_count }}">
                                            {{ percentage }}%
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-2 text-end">
                                    <span class="badge bg-secondary">{{ rating_breakdown[stars] }} reviews</span>
                                </div>
                            </div>
                            {% endfor %}
                            {% else %}
                            <p class="text-muted mb-0">No reviews yet. Rating breakdown will appear when you receive reviews.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Reviews -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><i class="fas fa-comment-dots me-2"></i>Recent Reviews</h5>
                        </div>
                        <div class="card-body">
                            {% if recent_reviews|length > 0 %}
                            <div class="table-responsive">
                                <table class="table align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th>Rating</th>
                                            <th>Comment</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for review in recent_reviews %}
                                        <tr>
                                            <td>
                                                <span class="badge bg-success">{{ review.rating }} ★</span>
                                            </td>
                                            <td>
                                                {{ review.comment or 'No comment left.' }}
                                            </td>
                                            <td>
                                                {{ review.created_at.strftime('%b %d, %Y') }}
                                            </td>
                                            <td>
                                                {% if review.doctor_response %}
                                                <span class="badge bg-success">Responded</span>
                                                {% else %}
                                                <span class="badge bg-warning text-dark">Needs response</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-3">
                                {% if viewer_role != 'clinic_manager' %}
                                <a href="{{ url_for('doctor_reviews') }}" class="btn btn-sm btn-primary">View all reviews</a>
                                {% endif %}
                            </div>
                            {% else %}
                            <p class="text-muted mb-0">No reviews yet. Your latest reviews will appear here.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Response Rate -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"><i class="fas fa-reply me-2"></i>Response Statistics</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Reviews Responded To</h6>
                                    <div class="progress mb-3" style="height: 30px;">
                                        <div class="progress-bar bg-info"
                                             role="progressbar"
                                             style="width: {{ response_rate }}%">
                                            {{ "%.0f"|format(response_rate) }}%
                                        </div>
                                    </div>
                                    <p class="text-muted">{{ response_count }} out of {{ review_count }} reviews have responses</p>
                                </div>
                                <div class="col-md-6">
                                    <h6>Response Rate Goal</h6>
                                    <p>
                                        {% if response_rate >= 80 %}
                                        <span class="badge bg-success fs-6"><i class="fas fa-check-circle"></i> Excellent</span>
                                        <p class="text-muted mt-2">You're doing great! High response rates build patient trust.</p>
                                        {% elif response_rate >= 50 %}
                                        <span class="badge bg-warning text-dark fs-6"><i class="fas fa-info-circle"></i> Good</span>
                                        <p class="text-muted mt-2">Try to respond to more reviews to improve patient engagement.</p>
                                        {% else %}
                                        <span class="badge bg-danger fs-6"><i class="fas fa-exclamation-circle"></i> Needs Improvement</span>
                                        <p class="text-muted mt-2">Responding to reviews shows patients you care about their feedback.</p>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Insights & Tips -->
            <div class="row">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-secondary text-white">
                            <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Insights & Tips</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6><i class="fas fa-chart-line me-2 text-success"></i>What's Working</h6>
                                    <ul>
                                        {% if avg_rating >= 4.0 %}
                                        <li>Your average rating of {{ "%.1f"|format(avg_rating) }} is excellent!</li>
                                        {% endif %}
                                        {% if response_rate >= 50 %}
                                        <li>You're actively engaging with patient feedback</li>
                                        {% endif %}
                                        {% if review_count >= 10 %}
                                        <li>You have a good number of reviews building trust</li>
                                        {% endif %}
                                        {% if avg_rating >= 4.0 and response_rate >= 50 and review_count >= 10 %}
                                        <li>Keep up the great work!</li>
                                        {% elif review_count == 0 %}
                                        <li>Once you get reviews, insights will appear here</li>
                                        {% endif %}
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6><i class="fas fa-bullseye me-2 text-primary"></i>Areas to Improve</h6>
                                    <ul>
                                        {% if response_rate < 80 %}
                                        <li>Aim to respond to at least 80% of your reviews</li>
                                        {% endif %}
                                        {% if review_count < 10 %}
                                        <li>Encourage satisfied patients to leave reviews</li>
                                        {% endif %}
                                        {% if avg_rating < 4.0 and review_count > 0 %}
                                        <li>Address concerns in negative reviews professionally</li>
                                        {% endif %}
                                        {% if response_rate >= 80 and review_count >= 10 and avg_rating >= 4.0 %}
                                        <li>You're doing excellent! Keep maintaining quality care</li>
                                        {% elif review_count == 0 %}
                                        <li>Get your first reviews to unlock detailed insights</li>
                                        {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='vendor/chartjs/chart.min.js') }}"></script>
<script>
// Profile Views Chart
const ctx = document.getElementById('viewsChart');
if (ctx) {
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ chart_data.dates|tojson }},
            datasets: [{
                label: 'Profile Views',
                data: {{ chart_data.views|tojson }},
                borderColor: '#7B2CBF',
                backgroundColor: 'rgba(123, 44, 191, 0.1)',
                tension: 0.3,
                fill: true,
                borderWidth: 2,
                pointRadius: 3,
                pointHoverRadius: 5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    mode: 'index',
                    intersect: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        precision: 0
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            }
        }
    });
}
</script>
{% endblock %}
